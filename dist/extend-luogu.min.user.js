// ==UserScript==
// @name           extend-luogu
// @namespace      http://tampermonkey.net/
// @description    Make luogu more powerful.
// @description:zh 使洛谷拥有更多功能
// @icon           https://raw.fastgit.org/extend-luogu/extend-luogu/main/favicon.ico
// @icon64         https://exlg.cc/img/logo.png
// @homepage       https://exlg.cc
// @version        5.8.0-pre1
//
// @match          https://*.luogu.com.cn/*
// @match          https://*.luogu.org/*
// @match          https://www.bilibili.com/robots.txt?*
// @match          https://service-ig5px5gh-1305163805.sh.apigw.tencentcs.com/release/APIGWHtmlDemo-1615602121
// @match          https://service-nd5kxeo3-1305163805.sh.apigw.tencentcs.com/release/exlg-nextgen
// @match          https://extend-luogu.github.io/exlg-setting-new/*
// @match          https://dash.exlg.cc/*
// @include        http://localhost:1634/*
//
// @connect        tencentcs.com
// @connect        luogulo.gq
// @connect        bens.rotriw.com
// @connect        codeforces.com
// @connect        codeforces.ml
// @connect        kenkoooo.com
// @connect        api.github.com
// @connect        exlg.piterator.com
// @connect        luogu-captcha-bypass.piterator.com
//
// @require        https://cdn.luogu.com.cn/js/jquery-2.1.1.min.js
// @require        https://cdn.jsdelivr.net/gh/leizongmin/js-xss@1.0.10/dist/xss.min.js
// @require        https://cdn.jsdelivr.net/gh/markedjs/marked@2.0.1/marked.min.js
// @require        https://cdn.jsdelivr.net/gh/ForkKILLET/TM-dat@0.8.3/TM-dat.user.js
//
// @grant          GM_addStyle
// @grant          GM_getValue
// @grant          GM_setValue
// @grant          GM_deleteValue
// @grant          GM_listValues
// @grant          GM_setClipboard
// @grant          GM_xmlhttpRequest
// @grant          unsafeWindow
// ==/UserScript==
;
(()=>{var x=unsafeWindow,k=(e,...t)=>x.console.log(`%c[exlg] ${e}`,"color: #0e90d2;",...t),q=(e,...t)=>x.console.warn(`%c[exlg] ${e}`,"color: #0e90d2;",...t),z=(e,...t)=>{throw x.console.error(`%c[exlg] ${e}`,"color: #0e90d2;",...t),Error(t.join(" "))},b=null,L=null;location.host==="www.luogu.com.cn"&&!/blog/g.test(location.href)&&(/(\?|&)_contentOnly($|=)/g.test(location.search)&&z("Content-Only pages."),x._feInjection.code!==200&&z("Luogu failed to load. Exlg stops loading."),b=x._feInjection.currentData,L=x._feInjection.currentUser);var ae=e=>[e.ctrlKey?"Ctrl":"",e.shiftKey?"Shift":"",e.altKey?"Alt":"",e.key.toInitialCase()].join(""),o=jQuery.extend({double:(e,t,n)=>[e(t),e(n)]});jQuery.fn.extend({whenKey:function(e,t){typeof e=="object"?this.on("keydown",n=>{let a=e[ae(n)];a&&a(n)}):this.on("keydown",n=>{ae(n)===e&&t(n)})}});var F=new filterXSS.FilterXSS({onTagAttr:(e,t,n)=>{if(t==="style")return`${t}="${n}"`}});Date.prototype.format=function(e,t){t=t?"UTC":"";let n={"y+":this[`get${t}FullYear`](),"m+":this[`get${t}Month`]()+1,"d+":this[`get${t}Date`](),"H+":this[`get${t}Hours`](),"M+":this[`get${t}Minutes`](),"S+":this[`get${t}Seconds`](),"s+":this[`get${t}Milliseconds`]()};for(let a in n)RegExp(`(${a})`).test(e)&&(e=e.replace(RegExp.$1,("000"+n[a]).substr(n[a].toString().length+3-RegExp.$1.length)));return e};String.prototype.toInitialCase=function(){return this[0].toUpperCase()+this.slice(1)};Array.prototype.lastElem=function(){return this[this.length-1]};var B=(e,t)=>{if(!e)return"<<";let n=(p,h)=>p===h?"==":p<h?"<<":">>",a=["pre","alpha","beta"],[[s,r],[l,c]]=[e,t].map(p=>p.split("-")),i,d;s===l?[i,d]=[r,c].map(p=>[p?a.findIndex(h=>p.startsWith(h)):1/0,p?.match(/[0-9]+$/g)?.[0]??1/0]):[i,d]=[s,l].map(p=>p.split("."));for(let[p,h]of i.entries())if(h!==d[p])return n(+h||0,+d[p]||0);return"=="},Z=(e,t)=>{let n=new URLSearchParams;for(let s in e)n.set(s,e[s]);let a=o(`
        <iframe id="exlg-${e.type}" src=" https://www.bilibili.com/robots.txt?${n}" style="${t}" exlg="exlg"></iframe>
    `);return k("Building springboard: %o",a[0]),a},P=({url:e,onload:t,onerror:n=a=>z(a)})=>GM_xmlhttpRequest({url:e,method:"GET",onload:t,onerror:n}),K=e=>new Promise((t,n)=>GM_xmlhttpRequest({url:e,method:"GET",onload:a=>t(a),onerror:a=>n(a)})),R=({url:e,data:t,type:n,header:a})=>new Promise((s,r)=>GM_xmlhttpRequest({url:e,method:"POST",data:t,headers:{"Content-Type":n,...a},onload:l=>s(l),onerror:l=>r(l)})),X=e=>{P({url:"https://api.github.com/repos/extend-luogu/extend-luogu/tags?per_page=1",onload:t=>{let n=JSON.parse(t.responseText)[0].name,a=GM_info.script.version,s=B(a,n),r=`Comparing version: ${a} ${s} ${n}`;k(r),e&&e(n,s)}})},re=(e=1)=>~~(new Date().getTime()/e),j=e=>new Promise((t,n)=>o.get(e+(e.includes("?")?"&":"?")+"_contentOnly=1",a=>{a.code!==200&&n(`Requesting failure code: ${t.code}.`),t(a)})),Q=x.show_alert?(e,t="exlg 提醒您")=>x.show_alert(t,e):(e,t="exlg 提醒您")=>x.alert(t+`
`+e),ne=null,I=(e,t)=>o.ajax({url:e,data:t,headers:{"x-csrf-token":ne===null?ne=o("meta[name=csrf-token]").attr("content"):ne,"content-type":"application/json"},method:"post"}),Y=e=>[/^AT[1-9][0-9]{0,}$/i,/^CF[1-9][0-9]{0,}[A-Z][0-9]?$/i,/^SP[1-9][0-9]{0,}$/i,/^P[1-9][0-9]{3,}$/i,/^UVA[1-9][0-9]{2,}$/i,/^U[1-9][0-9]{0,}$/i,/^T[1-9][0-9]{0,}$/i,/^B[2-9][0-9]{3,}$/i].some(t=>t.test(e)),J={_ac_func:null,wrapper:null,container:null,wait_time:null,header:null,content:null,autoquit:!0,show_dialog(){this.wrapper.css("display","flex"),setTimeout(()=>{this.container.removeClass("container-hide"),this.container.addClass("container-show")},50)},hide_dialog(){this.container.addClass("container-hide"),this.container.removeClass("container-show"),setTimeout(()=>this.wrapper.hide(),this.wait_time)},accept_dialog(){this._ac_func(()=>this.hide_dialog()),this.autoquit&&this.hide_dialog()},show_exlg_alert(e="",t="exlg 提醒您",n=()=>{},a=!0){this.autoquit=a,this._ac_func=n,this.header.text(t),this.content.html(e),this.show_dialog()}},$=(...e)=>J.show_exlg_alert(...e);var ee=`<svg xmlns="http://www.w3.org/2000/svg" height="30" viewBox="0 0 136.14 30.56">
<g transform="translate(1.755, 0)" fill="#00a0d8">
	<g>
		<path d="M5.02-33.80L34.56-33.80L34.07-28.62L16.96-28.62L15.93-21.92L31.97-21.92L31.48-16.74L14.85-16.74L13.82-8.42L31.97-8.42L31.48-3.24L2.43-3.24L6.59-31.75L5.02-33.80Z" transform="translate(-4.14, 33.9)"></path>
		<path d="M7.34-32.29L5.78-33.80L16.63-33.80L21.33-25.00L27.54-32.78L26.51-33.80L38.93-33.80L25.49-18.79L34.78-3.24L24.41-3.24L19.76-12.58L11.99-3.24L1.62-3.24L15.12-18.79L7.34-32.29Z" transform="translate(27.23, 33.9)"></path>
		<path d="M4.00-33.80L16.42-33.80L12.80-8.42L32.99-8.42L32.51-3.24L5.56-3.24Q4.00-3.24 3.21-4.27Q2.43-5.29 2.43-6.86L2.43-6.86L5.56-31.75L4.00-33.80Z" transform="translate(63.8, 33.9)"></path>
		<path d="M38.83-33.80L37.80-25.00L27.43-25.00L27.92-28.62L15.50-28.62L12.91-8.42L25.33-8.42L25.87-14.63L22.73-19.82L36.72-19.82L34.67-3.24L5.62-3.24Q4.86-3.24 4.21-3.51Q3.56-3.78 3.10-4.27Q2.65-4.75 2.48-5.43Q2.32-6.10 2.54-6.86L2.54-6.86L6.16-33.80L38.83-33.80Z" transform="translate(95.6, 33.9)"></path>
	</g>
</g>
</svg>`;var C=null,g={_:new Map,fake_sto:C,data:{},path_alias:[["",".*\\.luogu\\.(com\\.cn|org)"],["dash","dash.exlg.cc"],["cdn","cdn.luogu.com.cn"],["bili","www.bilibili.com"],["tcs1","service-ig5px5gh-1305163805.sh.apigw.tencentcs.com"],["tcs2","service-nd5kxeo3-1305163805.sh.apigw.tencentcs.com"],["tcs3","service-otgstbe5-1305163805.sh.apigw.tencentcs.com"],["debug","localhost:1634"],["ghpage","extend-luogu.github.io"]].map(([e,t])=>[new RegExp(`^@${e}/`),t]),path_dash_board:["@dash/((index|bundle)(.html)?)?","@ghpage/exlg-setting-new/((index|bundle)(.html)?)?","@debug/exlg-setting-new/((index|bundle).html)?"],reg:(e,t,n,a,s,r)=>{Array.isArray(n)||(n=[n]),n.forEach((l,c)=>{g.path_alias.some(([i,d])=>{if(l.match(i))return n[c]=l.replace(i,d+"/"),!0}),l.endsWith("$")||(n[c]+="$")}),g.data[e]={ty:"object",lvs:a||{}},"on"in g.data[e].lvs||(g.data[e].lvs.on={ty:"boolean",dft:!0}),t=t.replaceAll(" ","_"),g._.set(e,{info:t,path:n,func:s,styl:r})},reg_pre:(e,t,n,a,s,r,l)=>{g.reg(e,t,n,a,r,l),g._.set(e,{pre:s,...g._.get(e)})},reg_main:(e,t,n,a,s,r)=>g.reg("@"+e,t,n,a,l=>(s(l),!1),r),reg_user_tab:(e,t,n,a,s,r,l)=>g.reg(e,t,"@/user/.*",s,c=>{let i=o(".items"),d=()=>{(location.hash||"#main")==="#"+n&&(k(`Working user tab#${n} mod: "${e}"`),r({...c,vars:a}))};i.on("click",d),d()},l),reg_chore:(e,t,n,a,s,r,l)=>{if(typeof n=="string"){let c=+n.slice(0,-1),i={s:1e3,m:1e3*60,h:1e3*60*60,D:1e3*60*60*24}[n.slice(-1)];!isNaN(c)&&i?n=c*i:z(`Parsing period failed: "${n}"`)}e="^"+e,s={...s,last_chore:{ty:"number",dft:-1,priv:!0}},g.reg(e,t,a,s,async c=>{let i=C[e].last_chore,d=Date.now(),p=!0;c.named||!i||d-i>n?(p&&(GM_addStyle(l),p=!1),await r(c)?q(`Chore failed: "${e}"`):C[e].last_chore=Date.now()):k(`Pending chore: "${e}"`)})},reg_board:(e,t,n,a,s)=>g.reg(e,t,"@/",n,r=>{let l=o("#exlg-board");l.length||(l=o(`
                    <div class="lg-article" id="exlg-board" exlg="exlg"><h2>${ee} &nbsp;&nbsp;${GM_info.script.version}</h2></div>
                `).prependTo(".lg-right.am-u-md-4"),l[0].firstChild.style["font-size"]="1em"),a({...r,$board:o("<div></div>").appendTo(l)})},s),reg_hook:(e,t,n,a,s,r,l)=>g.reg(e,t,n,a,c=>{s(c),o("body").bind("DOMNodeInserted",i=>r(i)&&s(c))},l),reg_hook_new:(e,t,n,a,s,r,l,c)=>g.reg(e,t,n,a,i=>{s({...i,result:!1,args:l()}),o("body").bind("DOMNodeInserted",d=>{if(!d.target.tagName)return!1;let p=r(d);return p.result&&s({...i,...p})})},c),find:e=>g._.get(e),has:e=>g._.has(e),disable:e=>{let t=g.find(e);t.on=!1,g._.set(e,t)},enable:e=>{let t=g.find(e);t.on=!0,g._.set(e,t)},preload:e=>{C===null&&(C=g.fake_sto);let t=(a,s)=>{a||z(`Preloading named mod but not found: "${e}"`),k(`Preloading ${s?"named ":""}mod: "${a.name}"`);try{return{pred:a.pre({msto:C[a.name],named:s}),...a}}catch(r){return q(r),a}},n=location.href;for(let[a,s]of g._.entries())C[a].on&&s.path.some(r=>new RegExp(r,"g").test(n))&&(s.willrun=!0,"pre"in s&&g._.set(a,t({name:a,...s})))},execute:e=>{let t=(n,a)=>{n||z(`Executing named mod but not found: "${e}"`),n.styl&&GM_addStyle(n.styl),k(`Executing ${a?"named ":""}mod: "${n.name}"`);try{return"pred"in n?n.func({msto:C[n.name],named:a,pred:n.pred}):n.func({msto:C[n.name],named:a})}catch(s){q(s)}};if(e){let n=g.find(e);return t({name:e,...n},!0)}for(let[n,a]of g._.entries())if(a.on=C[n].on,a.willrun&&t({name:n,...a})===!1)break}};g.reg("benben","全网犇犇","@/",{source:{ty:"enum",dft:"o2",vals:["o2","shy"],info:["Source","切换全网犇犇获取方式"]},reply_with_md:{ty:"boolean",dft:!1,info:["Reply with markdown","回复时附上原 markdown"]}},({msto:e})=>{let t={Gray:"gray",Blue:"bluelight",Green:"green",Orange:"orange lg-bold",Red:"red lg-bold",Purple:"purple lg-bold",Brown:"brown lg-bold"},n=`
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="%" style="margin-bottom: -3px;" exlg="exlg">
            <path d="M16 8C16 6.84375 15.25 5.84375 14.1875 5.4375C14.6562 4.4375 14.4688 3.1875 13.6562 2.34375C12.8125 1.53125 11.5625 1.34375 10.5625 1.8125C10.1562 0.75 9.15625 0 8 0C6.8125 0 5.8125 0.75 5.40625 1.8125C4.40625 1.34375 3.15625 1.53125 2.34375 2.34375C1.5 3.1875 1.3125 4.4375 1.78125 5.4375C0.71875 5.84375 0 6.84375 0 8C0 9.1875 0.71875 10.1875 1.78125 10.5938C1.3125 11.5938 1.5 12.8438 2.34375 13.6562C3.15625 14.5 4.40625 14.6875 5.40625 14.2188C5.8125 15.2812 6.8125 16 8 16C9.15625 16 10.1562 15.2812 10.5625 14.2188C11.5938 14.6875 12.8125 14.5 13.6562 13.6562C14.4688 12.8438 14.6562 11.5938 14.1875 10.5938C15.25 10.1875 16 9.1875 16 8ZM11.4688 6.625L7.375 10.6875C7.21875 10.8438 7 10.8125 6.875 10.6875L4.5 8.3125C4.375 8.1875 4.375 7.96875 4.5 7.8125L5.3125 7C5.46875 6.875 5.6875 6.875 5.8125 7.03125L7.125 8.34375L10.1562 5.34375C10.3125 5.1875 10.5312 5.1875 10.6562 5.34375L11.4688 6.15625C11.5938 6.28125 11.5938 6.5 11.4688 6.625Z"></path>
        </svg>
    `,a=l=>l<=3?"":n.replace("%",l<=5?"#5eb95e":l<=7?"#3498db":"#f1c40f"),s=x.loadFeed;x.loadFeed=function(){x.feedMode==="all-exlg"?(P({url:e.source==="o2"?"https://service-ig5px5gh-1305163805.sh.apigw.tencentcs.com/release/APIGWHtmlDemo-1615602121":`https://bens.rotriw.com/api/list/proxy?page=${x.feedPage}`,onload:l=>{JSON.parse(l.response).forEach(i=>{let d=marked(F.process(i.content));o(`
                <li class="am-comment am-comment-primary feed-li" exlg="exlg">
                    <div class="lg-left">
                        <a href="/user/${i.user.uid}" class="center">
                            <img src="https://cdn.luogu.com.cn/upload/usericon/${i.user.uid}.png" class="am-comment-avatar">
                        </a>
                    </div>
                    <div class="am-comment-main">
                        <header class="am-comment-hd">
                            <div class="am-comment-meta">
                                <span class="feed-username">
                                    <a class="lg-fg-${t[i.user.color]}" href="/user/${i.user.uid}" target="_blank">
                                        ${i.user.name}
                                    </a>
                                    <a class="sb_amazeui" target="_blank" href="/discuss/show/142324">
                                        ${a(i.user.ccfLevel)}
                                    </a>
                                    ${i.user.badge?`<span class="am-badge am-radius lg-bg-${t[i.user.color]}">${i.user.badge}</span>`:""}
                                </span>
                                ${new Date(i.time*1e3).format("yyyy-mm-dd HH:MM")}
                                <a name="feed-reply">回复</a>
                            </div>
                        </header>
                        <div class="am-comment-bd">
                            <span class="feed-comment">
                                ${d}
                            </span>
                        </div>
                    </div>
                </li>
            `).appendTo(o("ul#feed")).find("a[name=feed-reply]").on("click",()=>{scrollToId("feed-content"),setTimeout(()=>o("textarea").trigger("focus").val(` || @${i.user.name} : ${e.reply_with_md?i.content:o(d).text()}`).trigger("input"),50)})})}}),e.source==="shy"&&(x.feedPage++,o("#feed-more").children("a").text("点击查看更多..."))):s()};let r=o(".feed-selector");o('<li class="feed-selector" id="exlg-benben-selector" data-mode="all-exlg" exlg="exlg"><a style="cursor: pointer">全网动态</a></li>').appendTo(r.parent()).on("click",l=>{let c=o(l.currentTarget);r.removeClass("am-active"),c.addClass("am-active"),e.source==="o2"&&o("#feed-more").hide(),x.feedPage=1,x.feedMode="all-exlg",o("li.am-comment").remove(),x.loadFeed()})});g.reg("benben-quickpost","CtrlEnter发送犇犇","@/",null,()=>o("textarea").whenKey("CtrlEnter",()=>o("#feed-submit").click()));g.reg("blog","博客Ex","@/blogAdmin/article/edit/.*",{format:{ty:"boolean",dft:!0,info:["Enable format","显示格式化按钮"]},hotkeys:{ty:"boolean",dft:!0,info:["Enable hotkeys","快捷键"]}},({msto:e})=>{let t=o(".mp-editor-menu");e.format&&(t.append('<li data-v-6d5597b1="" class="mp-divider"><span data-v-6d5597b1="">|</span></li>'),t.append(o('<li data-v-6d5597b1=""></li>').append(o('<a data-v-6d5597b1="" title="自动排版" unslectable="on" class="exlg-format-btn"></a>').append('<i data-v-6d5597b1="" unslectable="on" class="fa fa-check"></i>'))),o(".exlg-format-btn").on("click",()=>{let n=unsafeWindow.articleEditor.content;n=n.replaceAll(/([\u4e00-\u9fa5])([a-z])/igu,"$1 $2"),n=n.replaceAll(/([a-z])([\u4e00-\u9fa5])/igu,"$1 $2"),n=n.replaceAll(/([\u4e00-\u9fa5])(\$)/igu,"$1 $2"),n=n.replaceAll(/(\$)([\u4e00-\u9fa5])/igu,"$1 $2"),unsafeWindow.articleEditor.content=n})),e.hotkeys&&o(unsafeWindow).keypress(n=>{n.ctrlKey&&n.which===2?o("a[title='粗体']")[0].click():n.ctrlKey&&n.which===9?o("a[title='斜体']")[0].click():n.ctrlKey&&n.shiftKey&&n.which===24&&o("a[title='删除线']")[0].click()})},`
`);var le=".bb-rnkitm:nth-child(1)::marker{color:var(--lg-red);font-weight:900}.bb-rnkitm:nth-child(2)::marker{color:var(--lg-orange);font-weight:900}.bb-rnkitm:nth-child(3)::marker{color:var(--lg-yellow);font-weight:900}.bb-rnkitm>span{display:flex;flex-wrap:wrap}.bb-rnkitm>span>span{margin-left:auto}.bb-rnklst-span{font-size:1em;font-weight:400}";g.reg_board("search-user","用户查找",null,({$board:e})=>{e.html(`
        <h3>查找用户</h3>
        <div class="am-input-group am-input-group-primary am-input-group-sm">
            <input type="text" class="am-form-field" placeholder="例：kkksc03，可跳转站长主页" name="username" id="search-user-input">
        </div>
        <p>
            <button class="am-btn am-btn-danger am-btn-sm" id="search-user">跳转</button>
        </p>
    `);let t=()=>{n.prop("disabled",!0),o.get("/api/user/search?keyword="+o("[name=username]").val().trim(),a=>{a.users[0]?location.href="/user/"+a.users[0].uid:(n.prop("disabled",!1),$("无法找到指定用户"))})},n=o("#search-user").on("click",t);o("#search-user-input").keydown(a=>{a.key==="Enter"&&t()})});g.reg_board("benben-ranklist","犇犇龙王排行榜",{show:{ty:"boolean",dft:!0,info:["Show in default","是否默认展开"]}},({msto:e,$board:t})=>{t.html(`<h3 id="bb-rnklst-h2">犇犇排行榜 <span id="bb-rnklst-btn" class="bb-rnklst-span"> [<a>${e.show?"收起":"展开"}</a>]</span><span style="float: right;" class="bb-rnklst-span"> [<a id="refresh-bbrnk">刷新</a>]</span></h3><ol style="display: ${e.show?"block":"none"}" id="bb-rnklst"></ol>`);let n=t.find("#bb-rnklst"),a=t.find("#bb-rnklst-btn > a").on("click",()=>{e.show=!e.show,a.text(e.show?"收起":"展开"),n.toggle()}),s=()=>P({url:"https://bens.rotriw.com/ranklist?_contentOnly=1",onload:function(r){o(JSON.parse(r.response)).each((l,c)=>{o(`<li class="bb-rnkitm">
                    <span>
                        <a href="https://bens.rotriw.com/user/${c[2]}">${c[1]}</a>
                        <span>${c[0]} 条</span>
                    </span>
                </li>`).appendTo(n)})}});t.find("#refresh-bbrnk").on("click",()=>{n.html(""),s()}),s()},le);g.reg("captcha","验证码自动填充",["@/auth/login","@/discuss/.+","@/image"],null,()=>{let e=o("img[data-v-3e1b4641],#verify_img"),t=async()=>{let n=document.createElement("canvas");n.width=e[0].width,n.height=e[0].height,n.getContext("2d").drawImage(e[0],0,0);let a=o("input[placeholder$='验证码']")[0];a.value=(await R({url:"https://luogu-captcha-bypass.piterator.com/predict/",data:n.toDataURL("image/jpeg")})).responseText,a.dispatchEvent(new Event("input"))};e.length?(e.click(),e[0].onload=t):o(document).on("focus","input[placeholder$='验证码']",()=>{e=o("#--swal-image-hosting-upload-captcha"),e[0].onload=t})});var ie=".exlg-copy{position:relative;display:inline-block;border:1px solid #3498db;border-radius:3px;background-color:#3498db00;color:#3498db;font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Noto Sans,Noto Sans CJK SC,Noto Sans CJK,Source Han Sans,PingFang SC,Segoe UI,Microsoft YaHei,sans-serif;flex:none;outline:0;cursor:pointer;font-weight:400;line-height:1.5;text-align:center;vertical-align:middle;background:0 0;font-size:12px;padding:0 5px;margin-left:1px}.exlg-copy.exlg-copy-right{float:right}.exlg-copy:hover{background-color:#3498db1a}div.exlg-copied{background-color:#3498dbe6!important;color:#fff!important}.copy-btn{font-size:.8em;padding:0 5px}.lfe-form-sz-middle{font-size:.875em;padding:.313em 1em}.exlg-code-title{margin:0;font-family:inherit;font-size:1.125em;color:inherit}";g.reg_hook_new("code-block-ex","代码块优化","@/.*",{copy_code_position:{ty:"enum",vals:["left","right"],dft:"left",info:["Copy Button Position","复制按钮对齐方式"]},code_block_title:{ty:"string",dft:"源代码 - ${lang}",info:["Custom Code Title(with Language)","自定义代码块标题 - 限定语言"]},code_block_title_nolang:{ty:"string",dft:"源代码",info:["Custom Code Title(without Language)","自定义代码块标题 - 默认"]},copy_code_font:{ty:"string",dft:"'Fira Code', Consolas, monospace",info:["Code Block Font","代码块字体"],strict:!0},max_show_lines:{ty:"number",dft:-1,min:-1,max:100,info:["Max Lines On Show","代码块最大显示行数"],strict:!0}},({msto:e,args:t})=>{let n=/\/record\/.*/.test(location.href),a={c:"C",cpp:"C++",pascal:"Pascal",python:"Python",java:"Java",javascript:"JavaScript",php:"PHP",latex:"LaTeX"},s=r=>{let l="undefined";return n?o(o(".value.lfe-caption")[0]).text():(r.attr("data-rendered-lang")?l=r.attr("data-rendered-lang"):r.attr("class")&&r.attr("class").split(" ").forEach(c=>{c.startsWith("language-")&&(l=c.slice(9))}),a[l])};t.attr("exlg-copy-code-block",""),t.each((r,l,c=o(l))=>{if(l.parentNode.className==="mp-preview-content"||l.parentNode.parentNode.className==="mp-preview-area")return;let i=n?c.children(".copy-btn"):o('<div class="exlg-copy">复制</div>').on("click",()=>{i.text()==="复制"&&(i.text("复制成功").toggleClass("exlg-copied"),setTimeout(()=>i.text("复制").toggleClass("exlg-copied"),800),GM_setClipboard(c.text(),"text/plain"))}),d=c.children("code");d.css("font-family",e.copy_code_font||void 0),d.hasClass("hljs")||d.addClass("hljs").css("background","white"),i.addClass(`exlg-copy-${e.copy_code_position}`);let p=s(d),h=p?e.code_block_title.replace("${lang}",p):e.code_block_title_nolang,_=n?o(".lfe-h3").text(h):o(`<h3 class="exlg-code-title" style="/*width: 100%;*/">${h}</h3>`);n||c.before(_.append(i))})},e=>{let t=o(e.target).find("pre:has(> code:not(.cm-s-default)):not([exlg-copy-code-block])");return{result:t.length,args:t}},()=>o("pre:has(> code:not(.cm-s-default)):not([exlg-copy-code-block])"),ie);var D={_:new Map,data:{},sto:null,reg:(e,t,n,a,s)=>(n&&(D.data[e]={ty:"object",lvs:n}),D._.set(e,{info:t,func:a,styl:s}),(...r)=>a(...(n?[D.sto[e]]:[]).concat(r))),ready:()=>{for(let[e,t]of D._.entries())t.styl&&GM_addStyle(t.styl),k(`Preparing component: ${e}`)}};var qe=D.reg("register-badge","Badge_注册",null,e=>{let t=`exlg badge ${e?"修改":"注册"}器`;$(`<div class="exlg-update-log-text exlg-unselectable exlg-badge-page" style="font-family: Consolas;">
    <div style="text-align: center">
        <div style="display:inline-block;text-align: left;padding-top: 10px;">
            <div style="margin: 5px;">
                <span style="height: 1.5em;float: left;padding: .1em;width: 5em;">用户uid</span>
                <input exlg-badge-register type="text" style="padding: .1em;" class="am-form-field exlg-badge-input" placeholder="填写用户名或uid" value=${L.uid} disabled title="暂不支持为别人注册 badge" name="username">
            </div>
    ${e?"":`<div style="margin: 5px;">
                <span style="height: 1.5em;float: left;padding: .1em;width: 5em;">激活码</span>
                <input exlg-badge-register type="text" style="padding: .1em;" class="am-form-field exlg-badge-input" placeholder="您获取的激活码" name="username"></div>`}
    <div style="margin: 5px;margin-bottom: 20px;">
                <span style="height: 1.5em;float: left;padding: .1em;width: 5em;">badge</span>
                <input exlg-badge-register type="text" style="margin-bottom: 10px;padding: .1em;" class="am-form-field exlg-badge-input" placeholder="您想要的badge" name="username">
            </div>
        </div>
        <br>
        <small>Powered by <s>Amaze UI</s> 自行研发，去他妈的 Amaze UI</small>
    </div>
</div>
    `,t,async n=>{let a=o("#exlg-container"),s=a.find("input"),r=a.find("#exlg-dialog-title"),l=i=>{r.html(i),setTimeout(()=>r.html(t),1500)};if(L?.uid&&!s[0].value&&(s[0].value=L.uid),!s.get().some(i=>i.value)){l("[Err] 请检查信息是否填写完整");return}let c=await o.get("/api/user/search?keyword="+s[0].value);if(!c.users[0]){l("[Err] 无法找到指定用户");return}if(C["sponsor-tag"].use_new){let i=e?s[1].value:s[2].value;r.html("获取并验证令牌..."),g.execute("^token");let d={uid:s[0].value,token:C["^token"].token,data:{text:i}};e||(d.activation=s[1].value),r.html("请求中...");let p=(await R({url:"https://exlg.piterator.com/badge/set/",data:JSON.stringify(d),type:"application/json"})).responseText,h=JSON.parse(decodeURIComponent(p));"error"in h?(r.html("失败"),$(h.error,"激活 badge 出错")):(C["sponsor-tag"].tag_cache=JSON.stringify(JSON.parse(C["sponsor-tag"].tag_cache)[s[0].value]={text:h[s[0].value].text,ts:Date.now()/1e3}),r.html("成功"),$("badge 激活成功！感谢您对 exlg 的支持。","badge 激活成功",()=>{location.reload()}))}else{s[0].value=c.users[0].uid,r.html("请求中...");let i=(await K(e?`https://service-cmrlfv7t-1305163805.sh.apigw.tencentcs.com/release/edit/${s[0].value}/${s[1].value}/`:`https://service-cmrlfv7t-1305163805.sh.apigw.tencentcs.com/release/${s[1].value}/${s[0].value}/${s[2].value}/`)).responseText.slice(1,-1);if(i.startsWith("Error")){k(i),l(i);return}r.html("验证中...");let d=i.match(/content.*?'.*?'/g)[0].slice(9,-1);await I("/api/feed/postBenben",JSON.stringify({content:d}));let p=await K(i.match(/visit.*$/g)[0].slice(6)),h=p.responseText.slice(1,-1);if(h.startsWith("Error")){k(h),l(h);return}r.html("就要好了..."),o(await o.get("https://www.luogu.com.cn/feed/my?page=1")).find("div.am-comment-main").each((M,E)=>o(E).find("span.feed-comment").text().trim()===d&&I("https://www.luogu.com.cn/api/feed/delete/"+o(E).find("a[name='feed-delete']").attr("data-feed-id"),"{}")),n(),setTimeout(()=>$("点击确定将自动重新刷新 badge",`badge ${e?"修改":"注册"}成功!`,()=>{g.execute("^sponsor-list"),location.reload()},400))}},!1)},null),H=qe;var ce='#exlg-dash{margin-right:5px;position:relative;display:inline-block;padding:1px 10px 3px;color:#fff;border-radius:6px;box-shadow:0 0 7px #1e90ff;cursor:pointer}#exlg-dash>.exlg-warn{position:absolute;top:-.5em;right:-.5em}.exlg-icon:before{display:inline-block;width:1.3em;height:1.3em;margin-left:3px;text-align:center;border-radius:50%}.exlg-icon:hover:after{display:inline-block}.exlg-icon:after{display:none;content:attr(name);margin-left:5px;padding:0 3px;background-color:#fff;box-shadow:0 0 7px #00bfff;border-radius:7px}.exlg-icon.exlg-info:before{content:"i";color:#fff;background-color:#00bfff;font-style:italic}.exlg-icon.exlg-warn:before{content:"!";color:#fff;background-color:#e74c3c;font-style:normal}.exlg-unselectable{-webkit-user-select:none;-moz-user-select:none;-o-user-select:none;user-select:none}:root{--exlg-azure: #7bb8eb;--exlg-aqua: #03a2e8;--exlg-indigo: #3f48cb;--std-mediumturquoise: #48d1cc;--std-cornflowerblue: #6495ed;--std-dodgerblue: #1e90ff;--std-white: #fff;--std-black: #000;--lg-gray: #bbb;--lg-gray-2: #7f7f7f;--lg-gray-3: #6c757d;--lg-gray-4: #414345;--lg-gray-5: #333;--lg-gray-6: #000000bf;--lg-blue: #3498db;--lg-blue-button: #0e90d2;--lg-blue-dark: #34495e;--lg-blue-2: #7cb5ecbf;--lg-green: #5eb95e;--lg-green-dark: #054310c9;--lg-green-light: #5eb95e26;--lg-green-light-2: #c9e7c9;--lg-yellow: #f1c40f;--lg-orange: #e67e22;--lg-red: #e74c3c;--lg-red-light: #dd514c26;--lg-red-light-2: #f5cecd;--lg-red-button: #dd514c;--lg-purple: #8e44ad;--argon-indigo: #5e72e4;--argon-red: #f80031;--argon-red-button: #f5365c;--argon-green: #1aae6f;--argon-green-button: #2dce89;--argon-cyan: #03acca;--argon-yellow: #ff9d09;--lg-red-problem: #fe4c61;--lg-orange-problem: #f39c11;--lg-yellow-problem: #ffc116;--lg-green-problem: #52c41a;--lg-blue-problem: #3498db;--lg-purple-problem: #9d3dcf;--lg-black-problem: #0e1d69;--lg-gray-problem: #bfbfbf}.exlg-difficulty-color{font-weight:700}.exlg-difficulty-color.color-0{color:#bfbfbf!important}.exlg-difficulty-color.color-1{color:#fe4c61!important}.exlg-difficulty-color.color-2{color:#f39c11!important}.exlg-difficulty-color.color-3{color:#ffc116!important}.exlg-difficulty-color.color-4{color:#52c41a!important}.exlg-difficulty-color.color-5{color:#3498db!important}.exlg-difficulty-color.color-6{color:#9d3dcf!important}.exlg-difficulty-color.color-7{color:#0e1d69!important}.exlg-window{position:absolute;top:35px;left:0;z-index:65536;display:none;width:300px;padding:15px;background:white;color:#000;border-radius:7px;box-shadow:#bbe3ff 0 0 7px}.exlg-windiv-left-tag{height:2em;width:18%;margin-right:10px;display:inline-block;text-align:center}.exlg-windiv-btn{font-size:.9em;display:inline-block;flex:none;outline:0;cursor:pointer;color:#fff;font-weight:inherit;line-height:1.5;text-align:center;vertical-align:middle;background:0 0;border-radius:5px;border:1px solid;margin:4px}.dropdown>.center{padding:0 24px 18px}.ops>a>.link-title{display:flex;align-items:center}.ops>a>.link-title>svg{margin-right:8px;width:16px}.ops>a[class]{width:auto;display:flex;align-items:center;justify-content:space-between;padding:6px 14px;border-radius:8px;color:var(--text2);font-size:14px;cursor:pointer;transition:background-color .3s;margin-bottom:.4em;margin-top:.4em}.ops>a:hover{background-color:#e3e5e7}.wrapper.hover>.dropdown>.center{font-size:1.1em;width:18.18em}.exlg-dropdown.field{display:inline-block;border-left:none;padding:0 .8em}.exlg-dropdown.field:hover{color:#00aeec!important}.exlg-dropdown.field:hover>.value{color:#00aeec!important}.exlg-dropdown.field:hover>.key{color:#00aeec!important}.exlg-dropdown.field>.value{display:block;text-align:center;line-height:1.5;font-weight:700;color:#6c757d;font-size:1.1em;transition:color .2s}.exlg-dropdown.field>.key{display:block;text-align:center;color:#9499a0;font-weight:400;font-size:.75em;transition:color .2s}.exlg-dropdown.field>.key-small{display:block;text-align:center;color:#9499a0;font-weight:400;font-size:.5em;transition:color .2s}';g.reg_main("dash-board","控制面板",g.path_dash_board,{msg:{ty:"object",priv:!0,lvs:{queue:{ty:"array",itm:{ty:"object",lvs:{text:{ty:"string"},id:{ty:"number"}}}},last_id:{ty:"number",dft:0}}},lang:{ty:"enum",dft:"zh",vals:["zh","en"],info:["Language of descriptions in the dashboard","控制面板提示语言"]}},()=>{let e=[["Modules","功能","tunes",!1],["Core","核心","bug_report",!0]].map(([t,n,a,s])=>({name:t,description:n,icon:a,children:(()=>{let r=[];return g._.forEach((l,c)=>{c.startsWith("@")===s&&r.push({rawName:c,name:c.replace(/^[@^]/g,""),description:l.info,settings:Object.entries(g.data[c].lvs).filter(([i,d])=>i!=="on"&&!d.priv).map(([i,d])=>({name:i,displayName:i.split("_").map(p=>p.toInitialCase()).join(" "),description:d.info,type:{number:"SILDER",boolean:"CHECKBOX",string:"TEXTBOX",enum:""}[d.ty],...d.ty==="boolean"&&{type:"CHECKBOX"},...d.ty==="number"&&{type:"SLIDER",minValue:d.min,maxValue:d.max,increment:d.step},...d.ty==="enum"&&{type:"SELECTBOX",acceptableValues:d.vals}}))})}),r})()}));console.log(e),x.guiStart(e)});g.reg_hook_new("dash-bridge","控制桥","@/.*",{source:{ty:"enum",vals:["exlg","gh_index","debug"],dft:"exlg",info:["The website to open when clicking the exlg button","点击 exlg 按钮时打开的网页"]},enable_rclick:{priv:!0,ty:"boolean",dft:!0,info:["Use Right Click to change source","右键点击按钮换源"]},latest_ignore:{ty:"string",dft:"0.0.0"}},({msto:e,args:t})=>{["exlg","gh_index","debug"].indexOf(e.source)===-1&&(e.source="exlg");let n=t.$tar,a='<svg class="icon" style="width: 1.2em;height: 1.2em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1697"><path d="M644.266667 494.933333l-192 192-29.866667-29.866666 162.133333-162.133334-162.133333-162.133333 29.866667-29.866667 192 192z" fill="#444444" p-id="1698"></path></svg>',s=(p,h,_=o(h))=>{_.addClass("exlg-dash-options"),h.innerHTML=`<div class="link-title">${h.innerHTML}</div> ${a}`};if(t.type===2){s(114514,n[0],n);return}let r=!n.parent().hasClass("mobile-nav-container"),l=o('<span id="exlg-dash-window" class="exlg-window" style="display: none;"></span>').css("left","-125px"),c=o('<div id="exlg-dash" exlg="exlg">exlg</div>').prependTo(n).css("backgroundColor",{exlg:"cornflowerblue",gh_index:"darkblue",debug:"steelblue"}[e.source]).css("margin-top",n.hasClass("nav-container")?"5px":"0px"),i=()=>x.exlg.dash=x.open({exlg:"https://dash.exlg.cc/index.html",gh_index:"https://extend-luogu.github.io/exlg-setting-new/index.html",debug:"localhost:1634/dashboard"}[e.source]);e.enable_rclick?c.bind("contextmenu",()=>!1).on("mousedown",p=>{p.button?p.button===2&&(e.source={exlg:"gh_index",gh_index:"debug",debug:"exlg"}[e.source],c.css("backgroundColor",{exlg:"cornflowerblue",gh_index:"darkblue",debug:"steelblue"}[e.source])):i()}):c.on("click",i);let d=(p,h)=>{let _=L;p.children(".header").after(`
        <div>
            <a class="exlg-dropdown field" href="//www.luogu.com.cn/user/${_.uid}#following.following">
                <span class="value">${_.followingCount}</span>
                <span data-v-3c4577b8="" class="key">关注</span>
            </a>
            <a class="exlg-dropdown field" href="//www.luogu.com.cn/user/${_.uid}#following.follower">
                <span class="value">${_.followerCount}</span>
                <span data-v-3c4577b8="" class="key">粉丝</span>
            </a>
            <a class="exlg-dropdown field" href="//www.luogu.com.cn/user/notification">
                <span class="value">${_.unreadNoticeCount+_.unreadMessageCount}</span>
                <span data-v-3c4577b8="" class="key">动态</span>
            </a>
        </div>
        `),p.children(".header").after(`
        <div class="exlg-dropdown field">
            <span data-v-3c4577b8="" class="key-small">CCF 评级: <strong>${_.ccfLevel}</strong></span>
            <span data-v-3c4577b8="" class="key-small">咕值排行: <strong>${_.ranking}</strong></span>
        </div>
        `),h.each(s);let M=o(h[5]).clone().attr("href","javascript:void 0");M.on("click",i),o(h[5]).after(M),M.children("div.link-title").html('<svg data-v-a97ae32a="" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="code" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="svg-inline--fa fa-code fa-w-20"><path data-v-a97ae32a="" fill="currentColor" d="M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z" class=""></path></svg> 插件设置')};if(window.renew_dropdown=()=>d(n.find(".dropdown > .center"),n.find(".ops > a")),(n.hasClass("user-nav")||n.parent().hasClass("user-nav"))&&d(n.find(".dropdown > .center"),n.find(".ops > a")),r){l.prependTo(n);let p=!1,h=!1;c.on("mouseenter",()=>{p=!0,l.show()}).on("mouseleave",()=>{p=!1,h||setTimeout(()=>{h||l.hide()},200)}),l.on("mouseenter",()=>{h=!0}).on("mouseleave",()=>{h=!1,p||l.hide()}),o(`<h2 align="center" style="margin-top: 5px;margin-bottom: 10px;">${ee}</h2>`).appendTo(l);let _=o('<div id="exlg-windiv"></div>').appendTo(l);[{tag:"vers",title:"版本",buttons:[]},{tag:"source",title:"源码",buttons:[{html:"JsDelivr",url:"https://cdn.jsdelivr.net/gh/extend-luogu/extend-luogu/dist/extend-luogu.min.user.js"},{html:"Raw",url:"https://github.com/extend-luogu/extend-luogu/raw/latest/dist/extend-luogu.min.user.js"},{html:"FastGit",url:"https://hub.fastgit.xyz/extend-luogu/extend-luogu/raw/latest/dist/extend-luogu.min.user.js"}]},{tag:"link",title:"链接",buttons:[{html:"官网",url:"https://exlg.cc"},{col:"#666",html:`<a style="height: 8px;width: 8px;"><svg aria-hidden="true" height="12" viewBox="0 0 16 16" version="1.1" width="12" data-view-component="true" class="octicon octicon-mark-github">
                <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
            </svg></a>Github`,url:"https://github.com/extend-luogu/extend-luogu"},{html:"爱发电",url:"https://afdian.net/@extend-luogu"}]},{tag:"help",title:"帮助",buttons:[{html:"官方",url:"https://github.com/extend-luogu/extend-luogu/blob/main/README.md"},{html:"镜像",url:"https://hub.fastgit.xyz/extend-luogu/extend-luogu/blob/main/README.md"},{html:"用户协议",url:"https://www.luogu.com.cn/paste/3f7anw16"}]},{tag:"lhyakioi",title:"badge",buttons:[{html:"注册",onclick:()=>H(!1)},{html:"修改",onclick:()=>H(!0)}]}].forEach(E=>{let u=o(`<div id="${E.tag}-div"><span class="exlg-windiv-left-tag">${E.title}</span></div>`).appendTo(_),f=o("<span></span>").appendTo(u);if(E.buttons.forEach(m=>{let w=m.col??"#66ccff";o('<span class="exlg-windiv-btnspan"></span>').append(o(`<button class="exlg-windiv-btn" style="background-color: ${w};border-color: ${w};">${m.html}</button>`).on("click",m.onclick??(()=>location.href=m.url))).appendTo(f)}),E.tag==="vers"){f.append(o(`<span id="version-text" style="min-width: 60%; margin-left: 5px;">
    <span title="当前版本">${GM_info.script.version}</span>
    <span id="vers-comp-operator" style="margin-left: 5px;"></span>
    <span id="latest-version" style="margin-left: 5px;"></span>
    <span id="annoyingthings"></span></span>"`));let m=o('<button class="exlg-windiv-btn" style="background-color: red;border-color: red;float: right;margin: 0 20px 0 0;">刷新</button>'),w=f.find("#vers-comp-operator"),y=f.find("#latest-version"),v=f.find("#annoyingthings"),T=()=>{w.text(""),y.text(""),v.html(""),X((O,S)=>{if(w.html(S).css("color",{"<<":"#fe4c61","==":"#52c41a",">>":"#3498db"}[S]),y.text(O).attr("title","最新版本"),v.html({"<<":'<i class="exlg-icon exlg-info" name="有新版本"></i>',">>":'<i class="exlg-icon exlg-info" name="内测中！"></i>'}[S]||"").children().css("cssText","position: absolute;display: inline-block;"),S==="<<"&&B(e.latest_ignore,O)==="<<"){let N=o('<span style="color: red;margin-left: 30px;"><svg class="icon" style="vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" width="24" height="24" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5446"><path d="M512 128c-211.7 0-384 172.3-384 384s172.3 384 384 384 384-172.3 384-384-172.3-384-384-384z m0 717.4c-183.8 0-333.4-149.6-333.4-333.4S328.2 178.6 512 178.6 845.4 328.2 845.4 512 695.8 845.4 512 845.4zM651.2 372.8c-9.9-9.9-25.9-9.9-35.8 0L512 476.2 408.6 372.8c-9.9-9.9-25.9-9.9-35.8 0-9.9 9.9-9.9 25.9 0 35.8L476.2 512 372.8 615.4c-9.9 9.9-9.9 25.9 0 35.8 4.9 4.9 11.4 7.4 17.9 7.4s13-2.5 17.9-7.4L512 547.8l103.4 103.4c4.9 4.9 11.4 7.4 17.9 7.4s13-2.5 17.9-7.4c9.9-9.9 9.9-25.9 0-35.8L547.8 512l103.4-103.4c9.9-9.9 9.9-25.9 0-35.8z" p-id="5447"></path></svg></span>').on("click",()=>{e.latest_ignore=O,N.hide()}).appendTo(v)}S==="=="&&(e.latest_ignore=GM_info.script.version)})};m.on("click",T).appendTo(f)}})}},e=>{let t=o(e.target);if(e.target.tagName.toLowerCase()==="a"&&t.hasClass("color-none")&&t.parent().hasClass("ops")&&!t.hasClass("exlg-dash-options"))return{result:2,args:{$tar:o(e.target),type:2}};let n=t.find(".user-nav, .nav-container");return n.length&&!n.find("#exlg-dash-window").length?{result:n.length,args:{$tar:n[0].tagName==="DIV"?o(n[0].firstChild):n,type:1}}:{result:0}},()=>({$tar:o("nav.user-nav, div.user-nav > nav, .nav-container"),type:0}),ce);var de=".am-btn-warning{border-color:#ffc116;background-color:#ffc116;color:#fff}.am-btn-warning:hover{border-color:#f37b1d;background-color:#f37b1d;color:#fff}.am-btn{outline:none}";g.reg("discussion-save","讨论保存",["@/discuss/\\d+(\\?page\\=\\d+)*$"],{auto_save_discussion:{ty:"boolean",dft:!1,strict:!0,info:["Discussion Auto Save","自动保存讨论"]}},({msto:e})=>{let t=o('<button class="am-btn am-btn-success am-btn-sm" name="save-discuss">保存讨论</button>');t.on("click",()=>{t.prop("disabled",!0),t.text("保存中..."),P({url:`https://luogulo.gq/save.php?url=${window.location.href}`,onload:a=>{a.status===200?a.response==="success"?(k("Discuss saved"),t.text("保存成功"),setTimeout(()=>{t.text("保存讨论"),t.removeAttr("disabled")},1e3)):(k(`Discuss unsuccessfully saved, return data: ${a.response}`),t.text("保存失败"),t.toggleClass("am-btn-success").toggleClass("am-btn-warning"),setTimeout(()=>{t.text("保存讨论"),t.removeAttr("disabled"),t.toggleClass("am-btn-success").toggleClass("am-btn-warning")},1e3)):(k(`Fail to save discuss: ${a}`),t.toggleClass("am-btn-success").toggleClass("am-btn-danger"),setTimeout(()=>{t.text("保存讨论"),t.removeAttr("disabled"),t.toggleClass("am-btn-success").toggleClass("am-btn-danger")},1e3))},onerror:a=>{k(`Error:${a}`),t.removeAttr("disabled")}})}).css("margin-top","5px");let n=o(`<a class="am-btn am-btn-warning am-btn-sm" name="save-discuss" href="https://luogulo.gq/show.php?url=${location.href}">查看备份</a>`).css("margin-top","5px");o("section.lg-summary").find("p").append(o("<br>")).append(t).append(o("<span>&nbsp;</span>")).append(n),e.auto_save_discussion&&t.click()},de);var ge=".mp-editor-ground.exlg-ext.exlg-show-emo.exlg-show-emo-long{top:8.25em!important}.mp-editor-ground.exlg-ext.exlg-show-emo.exlg-show-emo-short{top:4.75em!important}.mp-editor-menu>br~li{position:relative;display:inline-block;margin:0;padding:5px 1px}.mp-editor-menu.exlg-show-emo.exlg-show-emo-long{height:6em!important;overflow:auto;background-color:#fff}.mp-editor-menu.exlg-show-emo.exlg-show-emo-short{height:2.5em!important;overflow:auto;background-color:#fff}.exlg-emo-btn{position:relative;top:0;border:none;background-color:#eee;border-radius:.7em;margin:.1em;transition:all .4s;height:2em}.exlg-emo-btn:hover{background-color:#f3f3f3;top:-3px}.exlg-emo,.exlg-ext{transition:all .15s}";var U={EMO:1,TXT:2};g.reg("emoticon","表情输入",["@/paste","@/discuss/.*","@/"],{benben:{ty:"boolean",dft:!0,info:["Show in benben","犇犇表情"]},show:{ty:"boolean",dft:!0,info:["Show in default","是否默认显示表情栏"]},src:{ty:"enum",vals:["图.tk","github","妙.tk","啧.tk"],dft:"图.tk",info:["Emoticon Source","表情源"]},height_limit:{ty:"boolean",dft:!0,info:["Expand in default","是否默认展开表情"]}},({msto:e})=>{let t=["kk","jk","se","qq","xyx","xia","cy","ll","xk","qiao","qiang","ruo","mg","dx","youl","baojin","shq","lb","lh","qd","fad","dao","cd","kun","px","ts","kl","yiw","dk",{name:["sto"],slug:"gg",name_display:"sto",width:40},{name:["orz"],slug:"gh",name_display:"orz",width:40},{name:["qwq"],slug:"g5",name_display:"qwq",width:40},{name:["hqlm"],slug:"l0",name_display:"火前留名"},{name:["sqlm"],slug:"l1",name_display:"山前留名"},{name:["xbt"],slug:"g1",name_display:"屑标题"},{name:["iee","wee"],slug:"g2",name_display:"我谔谔"},{name:["kg"],slug:"g3",name_display:"烤咕"},{name:["gl"],slug:"g4",name_display:"盖楼"},{name:["wyy"],slug:"g6",name_display:"无意义"},{name:["wgzs"],slug:"g7",name_display:"违规紫衫"},{name:["tt"],slug:"g8",name_display:"贴贴"},{name:["jbl"],slug:"g9",name_display:"举报了"},{name:["%%%","mmm"],slug:"ga",name_display:"%%%"},{name:["ngrb"],slug:"gb",name_display:"你谷日爆"},{name:["qpzc","qp","zc"],slug:"gc",name_display:"前排资瓷"},{name:["cmzz"],slug:"gd",name_display:"臭名昭著"},{name:["zyx"],slug:"ge",name_display:"致远星"},{name:["zh"],slug:"gf",name_display:"祝好"}].filter(d=>e.src!=="啧.tk"||typeof d!="object").map((d,p)=>typeof d=="string"?{type:U.EMO,name:[d],slug:p>=10?String.fromCharCode(97+(p-10)):String.fromCharCode(48+p)}:{type:U.TXT,...d}),n=e.src==="github"?({slug:d})=>`//cdn.jsdelivr.net/gh/extend-luogu/extend-luogu/img/emoji/${d}`:e.src==="啧.tk"?({name:d})=>`//${e.src}/${d[0]}`:({slug:d})=>`//${e.src}/${d}`;if(e.benben&&location.pathname==="/"){let d=o("#feed-content"),p=d[0];o("#feed-content").before("<div id='emo-lst'></div>"),t.forEach(h=>{let _=o(h.type===U.EMO?`<button class="exlg-emo-btn" exlg="exlg"><img src="${n(h)}" /></button>`:`<button class="exlg-emo-btn" exlg="exlg">${h.name_display}</button>`).on("click",()=>{let M=p.value,E=p.selectionStart,u=M.slice(0,E)+`![](${n(h)})`;p.value=u+M.slice(p.selectionEnd),p.focus(),p.setSelectionRange(u.length,u.length)}).appendTo("#emo-lst");h.width?_.css("width",h.width+"px"):h.type===U.EMO?_.css("width","40px"):_.css("width","83px")}),o("#feed-content").before("<br>")}let a=o(".mp-editor-menu"),s=o(".CodeMirror-wrap textarea");if(!a.length)return;let r=a.clone().addClass("exlg-emo").text("");a.after(r).append("<br />");let l=o(".mp-editor-ground").addClass("exlg-ext"),c=a.children().first().clone(!0).addClass("exlg-unselectable"),i=a.children().first().clone(!0).addClass("exlg-unselectable");a.children().last().before(c),a.children().last().before(i),c.children().attr("title","").text(e.show?"隐藏":"显示"),e.show&&(r.addClass("exlg-show-emo"),l.addClass("exlg-show-emo")),c.on("click",()=>{c.children()[0].innerHTML=["显示","隐藏"][["隐藏","显示"].indexOf(c.children()[0].innerHTML)],r.toggleClass("exlg-show-emo"),l.toggleClass("exlg-show-emo"),e.show=!e.show}),i.children().attr("title","").text(e.height_limit?"展开":"收起"),e.height_limit?(r.addClass("exlg-show-emo-short"),l.addClass("exlg-show-emo-short")):(r.addClass("exlg-show-emo-long"),l.addClass("exlg-show-emo-long")),i.on("click",()=>{i.children()[0].innerHTML=["收起","展开"][["展开","收起"].indexOf(i.children()[0].innerHTML)],r.toggleClass("exlg-show-emo-short").toggleClass("exlg-show-emo-long"),l.toggleClass("exlg-show-emo-short").toggleClass("exlg-show-emo-long"),e.height_limit=!e.height_limit}),t.forEach(d=>{let p=o(d.type===U.EMO?`<button class="exlg-emo-btn" exlg="exlg"><img src="${n(d)}" /></button>`:`<button class="exlg-emo-btn" exlg="exlg">${d.name_display}</button>`).on("click",()=>s.trigger("focus").val(`![](${n(d)})`).trigger("input")).appendTo(r);d.width?p.css("width",d.width+"px"):d.type===U.EMO?p.css("width","40px"):p.css("width","83px")}),r.append("<div style='height: .35em'></div>")},ge);var pe="input[exlg-badge-register]{outline:none;display:inline-block;width:auto;padding:.5em;line-height:1.2;color:#555;vertical-align:middle;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:0;-webkit-appearance:none;-webkit-transition:border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}input[exlg-badge-register]:focus{border:1px solid #3bb4f2}body{margin:0}.exlg-dialog-footer{bottom:0;position:absolute;right:0;padding:10px 6px}.exlg-dialog-container.container-show:hover>.exlg-dialog-btn{background:rgba(255,255,255,.8)}.exlg-dialog-btn{margin:0 4px;float:right;color:#666;min-width:75px;cursor:pointer;background:rgba(255,255,255,.2);padding:7px 10px;border:1px solid #ddd;border-radius:3px}.exlg-dialog-container.container-hide{opacity:0}.exlg-dialog-container.container-show:hover{background:rgba(250,250,250,.8);box-shadow:0 2px 8px #0006;opacity:1}.exlg-dialog-container{filter:blur(0);position:relative;opacity:.75;background:rgba(204,204,204,.2);width:500px;min-height:300px;border-radius:5px;margin:0 auto;box-shadow:0 2px 8px #00000040;font-size:16px;line-height:1.5;backdrop-filter:blur(20px)}.exlg-dialog-wrapper{position:fixed;left:0;top:0;background:rgba(0,0,0,0);width:100%;height:100%;align-items:center;display:table-cell;z-index:10}.exlg-dialog-header{height:auto;border-bottom:1px solid #eee;padding:11px 20px}.exlg-dialog-body{text-align:center;margin-bottom:50px;padding:20px 30px 10px;line-height:2}#header-right{position:absolute;width:30px;height:30px;border-radius:5px;background:rgba(0,0,0,0);color:red;right:10px;top:10px;text-align:center}";g.reg("exlg-dialog-board","exlg 公告板","@/.*",{animation_speed:{ty:"enum",dft:".4s",vals:["0s",".2s",".25s",".4s"],info:["Speed of Board Animation","启动消失动画速度"]},confirm_position:{ty:"enum",dft:"right",vals:["left","right"],info:["Position of Confirm Button","确定按钮相对位置"]}},({msto:e})=>{let t,n,a,s,r=!1;t=o('<div class="exlg-dialog-wrapper" id="exlg-wrapper" style="display: none;">').append(n=o(`<div class="exlg-dialog-container container-hide" id="exlg-container" style="${e.animation_speed==="0s"?"":`transition: all ${e.animation_speed};`}"></div>`).append(o('<div class="exlg-dialog-header">').append(a=o('<strong id="exlg-dialog-title">我做东方鬼畜音mad，好吗</strong>')).append(o('<div id="header-right" onclick="" style="opacity: 0.5;"><svg class="icon" style="vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5446"><path d="M512 128c-211.7 0-384 172.3-384 384s172.3 384 384 384 384-172.3 384-384-172.3-384-384-384z m0 717.4c-183.8 0-333.4-149.6-333.4-333.4S328.2 178.6 512 178.6 845.4 328.2 845.4 512 695.8 845.4 512 845.4zM651.2 372.8c-9.9-9.9-25.9-9.9-35.8 0L512 476.2 408.6 372.8c-9.9-9.9-25.9-9.9-35.8 0-9.9 9.9-9.9 25.9 0 35.8L476.2 512 372.8 615.4c-9.9 9.9-9.9 25.9 0 35.8 4.9 4.9 11.4 7.4 17.9 7.4s13-2.5 17.9-7.4L512 547.8l103.4 103.4c4.9 4.9 11.4 7.4 17.9 7.4s13-2.5 17.9-7.4c9.9-9.9 9.9-25.9 0-35.8L547.8 512l103.4-103.4c9.9-9.9 9.9-25.9 0-35.8z" p-id="5447"></path></svg></div>').on("click",()=>J.hide_dialog()))).append(o('<div class="exlg-dialog-body">').append(s=o('<div id="exlg-dialog-content">'))).append(o('<div class="exlg-dialog-footer">').append(o('<button class="exlg-dialog-btn">确定</button>').on("click",()=>J.accept_dialog()))[e.confirm_position==="left"?"prepend":"append"](o('<button class="exlg-dialog-btn">取消</button>').on("click",()=>J.hide_dialog()))).on("click",p=>p.stopPropagation()).on("mousedown",p=>p.stopPropagation())).on("mousedown",()=>r=!0).on("mouseup",()=>{r&&J.hide_dialog(),r=!1}).appendTo(o(document.body));let[l,c,i,d]=[t,n,a,s];Object.assign(J,{wrapper:l,container:c,header:i,content:d,wait_time:{"0s":0,".2s":100,".25s":250,".4s":400}[e.animation_speed]})},pe);var ue="#exlg-cli{position:fixed;top:0;z-index:65536;display:none;width:100%;height:40px;background-color:#fff;box-shadow:0 0 7px #1e90ff}#exlg-cli-input{display:block;height:100%;width:100%;border:none;outline:none;font-family:Fira Code,consolas,Courier New,monospace;color:#000}#exlg-cli-input.error{background-color:#cd5c5c}";g.reg("keyboard-and-cli","键盘操作与命令行","@/.*",{lang:{ty:"enum",dft:"en",vals:["en","zh"]}},({msto:e})=>{let t=o('<div id="exlg-cli" exlg="exlg"></div>').appendTo(o("body")),n=o('<input id="exlg-cli-input" />').appendTo(t),a=!1,s=(u,...f)=>{a=!0;let m=u.map((w,y)=>w.split(/\b/).map(v=>p[v]?.[h-1]??v).join("")+(f[y]||"")).join("");return n.val(m)},r=(u,...f)=>q(s(u,...f).addClass("error").val()),l=()=>(a=!1,n.val("").removeClass("error")),c=[],i=0,d=["en","zh"],p={".":["。"],",":["，"],"!":["！"],"?":["？"],cli:["命令行"],current:["当前"],language:["语言"],available:["可用"],command:["命令"],commands:["命令"],unknown:["未知"],forum:["板块"],target:["目标"],mod:["模块"],action:["操作"],illegal:["错误"],param:["参数"],expected:["期望"],type:["类型"],lost:["缺失"],essential:["必要"],user:["用户"]},h=d.indexOf(e.lang)||0,_=(u,f,m,w)=>(f=f.replace(/ /g,"").split(",").map(y=>{let v={};return y[0]==="["?(v.essential=!1,y=y.slice(1,-1)):v.essential=!0,[v.name,v.type]=y.split(":"),v}),{name:u,arg:f,help:m,fn:w}),M=[_("help","[cmd: string]",["get the help of <cmd>. or list all cmds.","获取 <cmd> 的帮助。空则列出所有"],u=>{if(!u)s`exlg cli. current language: ${h}, available commands: ${Object.keys(M).join(", ")}`;else{let f=M[u];if(!f)return r`help: unknown command "${u}"`;let m=f.arg.map(w=>{let y=w.name+": "+w.type;return w.essential?`<${y}>`:`[${y}]`}).join(" ");s`${u} ${m} ${f.help[h]}`}}),_("cd","path: string",["jump to <path>, relative path is OK.","跳转至 <path>，支持相对路径。"],u=>{let f;if(u[0]==="/")f=u;else{let m=location.pathname.replace(/^\/+/,"").split("/");u.split("/").forEach(y=>{y!=="."&&(y===".."?m.pop():m.push(y))}),f=m.join("/")}location.href=location.origin+"/"+f.replace(/^\/+/,"")}),_("cdd","forum: string",["jump to the forum named <forum> of discussion. use all the names you can think of.","跳转至名为 <forum> 的讨论板块，你能想到的名字基本都有用。"],u=>{let f=[["relevantaffairs","gs","gsq","灌水","灌水区","r","ra"],["academics","xs","xsb","学术","学术版","a","ac"],["siteaffairs","zw","zwb","站务","站务版","s","sa"],["problem","tm","tmzb","题目","题目总版","p"],["service","fk","fksqgd","反馈","反馈、申请、工单专版","se"]];if(u=f.find(m=>m.includes(u))?.[0],!f)return r`cdd: unknown forum "${u}"`;location.href=`https://www.luogu.com.cn/discuss/lists?forumname=${u}`}),_("cc","[name: char]",['jump to <name>, "h|p|c|r|d|i|m|n" stands for home|problem|contest|record|discuss|I myself|message|notification. or jump home.','跳转至 [name]，"h|p|c|r|d|i|m|n" 代表：主页|题目|比赛|评测记录|讨论|个人中心|私信|通知。空则跳转主页。'],u=>{u=u||"h";let f={h:"/",p:"/problem/list",c:"/contest/list",r:"/record/list",d:"/discuss/lists",i:"/user/"+L.uid,m:"/chat",n:"/user/notification"}[u];f?M.cd.fn(f):r`cc: unknown target "${u}"`}),_("mod","action: string, [name: string]",['for <action> "enable|disable|toggle", opearte the mod named <name>.','当 <action> 为 "enable|disable|toggle"，对名为 <name> 的模块执行对应操作：启用|禁用|切换。'],(u,f)=>{switch(u){case"enable":case"disable":case"toggle":if(!g.has(f))return r`mod: unknown mod "${f}"`;C[f].on={enable:()=>!0,disable:()=>!1,toggle:m=>!m}[u](C[f].on);break;default:return r`mod: unknown action "${u}"`}}),_("dash","action: string",['for <action> "show|hide|toggle", opearte the exlg dashboard.','当 <action> 为 "show|hide|toggle", 显示|隐藏|切换 exlg 管理面板。'],u=>{if(!["show","hide","toggle"].includes(u))return r`dash: unknown action "${u}"`;o("#exlg-dash-window")[u]()}),_("lang","lang: string",['for <lang> "en|zh" switch current cli language.','当 <lang> 为 "en|zh"，切换当前语言。'],u=>{try{e.lang=u,h=d.indexOf(u)}catch{return r`lang: unknown language ${u}`}}),_("uid","uid: integer",["jumps to homepage of user whose uid is <uid>.","跳转至 uid 为 <uid> 的用户主页。"],u=>location.href=`/user/${u}`),_("un","name: string",["jumps to homepage of user whose username is like <name>.","跳转至用户名与 <name> 类似的用户主页。"],u=>{o.get("/api/user/search?keyword="+u,f=>{f.users[0]?location.href="/user/"+f.users[0].uid:r`un: unknown user "${u}".`})})].reduce((u,f)=>(u[f.name]=f,u),{}),E=u=>{k(`Parsing command: "${u}"`);let f=u.trim().replace(/^\//,"").split(" "),m=f.shift();if(!m)return;let w=M[m];if(!w)return r`exlg: unknown command "${m}"`;let y=-1,v;for([y,v]of f.entries()){let T=w.arg[y].type;if((T==="number"||T==="integer")&&(f[y]=+v),!(T==="char"&&v.length===1||T==="number"&&!isNaN(f[y])||T==="integer"&&!isNaN(f[y])&&!(f[y]%1)||T==="string"))return r`${m}: illegal param "${v}", expected type ${T}.`}if(w.arg[y+1]?.essential)return r`${m}: lost essential param "${w.arg[y+1].name}"`;w.fn(...f)};n.on("keydown",u=>{switch(u.key){case"Enter":if(a)return l();let f=n.val();if(c.push(f),i=c.length,E(f),!a)return l();break;case"/":a&&l();break;case"Escape":t.hide();break;case"ArrowUp":case"ArrowDown":let m=i+{ArrowUp:-1,ArrowDown:1}[u.key];if(m<0||m>=c.length)return;i=m,n.val(c[m]);break}}),o(x).on("keydown",u=>{let f=o(document.activeElement);if(f.is("body")){let m={ArrowLeft:"prev",ArrowRight:"next"}[u.key];if(m)return o(`a[rel=${m}]`)[0].click();if(u.shiftKey){let w={ArrowUp:0,ArrowDown:1e6}[u.key];w!==void 0&&x.scrollTo(0,w)}u.key==="/"&&(t.show(),l().trigger("focus"))}else f.is("[name=captcha]")&&u.key==="Enter"&&o("#submitpost, #submit-reply")[0].click()})},ue);var me=".exlg-high-risk{color:#dd514c}.exlg-med-risk{color:#ff5722}.exlg-low-risk{color:#8c8c8c}";g.reg("malicious-code-identifier","有害代码检查器",["@/discuss/\\d+(\\?page\\=\\d+)*$"],{strength:{ty:"number",dft:3,min:1,max:5,step:1,info:["Strength","强度"],strict:!0}},({msto:e})=>{let t=o("code").text().toLowerCase(),n=e.strength,a=[],s=t.match("system")&&!(t.match("System.out")||t.match("import java"));n>=1&&(s&&t.match("net user")&&a.push("高危 操作用户"),s&&t.match("shutdown")&&a.push("高危 关机"),s&&t.match("socksorkstation")&&a.push("高危 锁定桌面"),s&&t.match("reg add")&&a.push("高危 注册进程")),n>=2&&(s&&t.match("taskkill")&&a.push("危险 关闭进程"),s&&t.match("setcursorpos")&&a.push("危险 修改光标")),n>=3&&(t.match("windows.h")&&a.push("可疑 引用 windows.h"),s&&(a.push("可疑 调用系统函数"),s=!0),s&&(t.match("encode")||t.match("decode"))&&a.push("高危 存在加密字符串")),a.length!==0&&$(a.join("</br>").replaceAll("高危",'<a class = "exlg-high-risk">[高危]</a>').replaceAll("危险",'<a class = "exlg-med-risk">[危险]</a>').replaceAll("可疑",'<a class = "exlg-low-risk">[可疑]</a>'),"发现有害代码")},me);var fe="#exlg-messages-outter{z-index:9999;position:fixed;right:1em;bottom:96px;border-radius:.6em;padding:6px;width:calc(18em + 12px);overflow:hidden}#exlg-messages-container{position:relative;width:100%;height:100%}.exlg-message-outter{background-color:#faf9fa;border-radius:.6em;width:18em;height:6em;box-shadow:0 0 6px #e1e1e2;position:relative;margin:.4em 0}.exlg-message-inner{width:100%;height:100%}.exlg-message-avatar{position:absolute;top:.8em;left:.8em;border-radius:100%;width:3.4em;height:3.4em}.exlg-message-username{position:absolute;top:.4em;left:4.7em;width:10.5em;font-weight:700;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.exlg-message-content{position:absolute;top:2em;left:4.7em;width:12em;line-height:1;word-break:break-all;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}.exlg-message-type{position:absolute;top:5.45em;left:1.1em;font-size:.8em;color:#bbbabb}.exlg-message-close{position:absolute;top:.4em;right:.4em;width:1.2em;height:1.2em;border-radius:100%;text-align:center;background-color:#f1f0f1;box-sizing:border-box;transition:ease-in-out background-color .1s;cursor:pointer}.exlg-message-close:hover{background-color:#e3e2e3}.exlg-message-close>svg{position:relative;top:40%;transform:translateY(-50%)}.exlg-message-show{display:block;color:#000;text-decoration:none;position:absolute;top:5.2em;right:.5em;font-size:.8em;padding-top:.1em;width:5em;height:1.7em;border-radius:.3em;text-align:center;background-color:#f1f0f1;box-sizing:border-box;transition:ease-in-out background-color .1s}.exlg-message-show:hover{background-color:#e3e2e3;color:#000}.exlg-message-show:visited{color:#000}";g.reg("messages","新消息提醒",["@/.*"],{},()=>{let e={},t=!1,n=0,a=L.uid;o("body").append('<div id="exlg-messages-outter"><div id="exlg-messages-container"></div></div>');function s(r){o("#exlg-messages-container").append(`
        <div class="exlg-message-outter" id="exlg-message-${r.id}">
            <div class="exlg-message-inner">
                <a href="https://www.luogu.com.cn/user/${r.sender.uid}" target="_blank">
                    <img class="exlg-message-avatar" src="https://cdn.luogu.com.cn/upload/usericon/${r.sender.uid}.png">
                </a>
                <div class="exlg-message-username" id="exlg-message-username-${r.id}"></div>
                <div class="exlg-message-content" id="exlg-message-content-${r.id}"></div>
                <div class="exlg-message-type">私信</div>
            </div>
            <div class="exlg-message-close" msg-id="${r.id}" id="exlg-message-close-${r.id}">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                    <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                </svg>
            </div>
            <a class="exlg-message-show" id="exlg-message-show-${r.id}" href="https://www.luogu.com.cn/chat" target="_blank">查看</a>
        </div>`),o(`#exlg-message-close-${r.id}`).click(function(){o(`#exlg-message-${r.id}`).remove()}),o(`#exlg-message-show-${r.id}`).click(function(){o(`#exlg-message-${r.id}`).remove()}),o(`#exlg-message-username-${r.id}`).text(r.sender.name),o(`#exlg-message-content-${r.id}`).text(r.content)}setInterval(function(){o.ajax({url:"https://www.luogu.com.cn/chat",type:"get",headers:{"x-luogu-type":"content-only"},success:function(r){let l=r.currentData.latestMessages.result;if(t&&l[0].id!==e[0].id){let c=[];for(let i=0;i<r.currentData.latestMessages.count;++i)if(l[i].id>n)if(l[i].sender.uid!==a)c.push(l[i]);else break;for(let i=c.length-1;i>=0;--i)console.log(c[i].content),s(c[i])}t=!0,e=l,n=l[0].id},error:function(r){console.log(`Messages fetch error: ${r}`)}})},1e3)},fe);var he="a.sol-btn{transition:opacity 2s cubic-bezier(.8,0,.9,-.03);opacity:0}a.sol-btn:hover{opacity:1}.item-row{display:none}";var be=".exlg-back-to-contest{text-decoration:none;float:right;color:#e74c3c}.exlg-back-to-contest:hover{color:#e74c3c}";g.reg("dbc-jump","双击题号跳题","@/.*",null,()=>{o(document).on("dblclick",e=>{let t=window.getSelection().toString().trim().toUpperCase(),n=e.ctrlkey?o(".ops > a[href*=blog]").attr("href")+"solution-":"https://www.luogu.com.cn/problem/";Y(t)&&window.open(n+t)})});g.reg("hide-solution","隐藏题解",["@/problem/[A-Z0-9]+","@/problem/solution/.*"],{hidesolu:{ty:"boolean",dft:!1,priv:!0},on:{ty:"boolean",dft:!1}},()=>/@\/problem\/[A-Z0-9]+/g.test(location.href)&&o('a[href^="/problem/solution"]').addClass("sol-btn"),he);g.reg_hook_new("back-to-contest","返回比赛列表",["@/problem/[A-Z0-9]+\\?contestId=[1-9][0-9]{0,}"],null,({args:e})=>{let t=e.$info_rows,n=o('<a class="exlg-back-to-contest"></a>'),a=e.cid;!e.pid||!a||t.children(".exlg-back-to-contest").length>0||n.attr("href",`/contest/${a}#problems`).html(`<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="door-open" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="svg-inline--fa fa-door-open fa-w-20">
            <path data-v-450d4937="" data-v-303bbf52="" fill="currentColor" d="M624 448h-80V113.45C544 86.19 522.47 64 496 64H384v64h96v384h144c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM312.24 1.01l-192 49.74C105.99 54.44 96 67.7 96 82.92V448H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h336V33.18c0-21.58-19.56-37.41-39.76-32.17zM264 288c-13.25 0-24-14.33-24-32s10.75-32 24-32 24 14.33 24 32-10.75 32-24 32z"></path>
            </svg>返回列表`).appendTo(t)},e=>{let t=e.target,n=b.contest.id,a=b.problem.pid;return{args:{cid:n,pid:a,$info_rows:o(t.parentNode)},result:t.tagName.toLowerCase()==="a"&&(t.href||"").includes("/record/list")&&t.href.slice(t.href.indexOf("/record/list"))===`/record/list?pid=${a}&contestId=${n}`}},()=>({cid:b.contest.id,pid:b.problem.pid,$info_rows:o(".info-rows").parent()}),be);g.reg_hook_new("submission-color","记录难度可视化","@/record/list.*",null,(e=>async({args:t})=>{t&&(location.href in e||(e[location.href]=j(location.href)),o(t.pid).addClass("exlg-difficulty-color").addClass(`color-${(await e[location.href]).currentData.records.result.filter(n=>n.problem.pid===t.pid.innerText.trim())[0].problem.difficulty}`))})({[location.href]:unsafeWindow._feInjection}),e=>e.target&&e.target.tagName.toLowerCase()==="a"&&/^\/problem\/[A-Z][A-Z0-9]+$/.exec(new URL(e.target.href).pathname)?{result:!0,args:{pid:e.target.firstChild}}:{result:!1},()=>null);g.reg("mainpage-discuss-limit","主页讨论个数限制",["@/"],{max_discuss:{ty:"number",dft:12,min:4,max:16,step:1,info:["Max Discussions On Show","主页讨论显示上限"],strict:!0}},({msto:e})=>{let t;location.href.includes("blog")||(o(".lg-article").each((n,a,s=o(a))=>{let r=a.childNodes[1];r&&r.tagName.toLowerCase()==="h2"&&r.innerText.includes("讨论")&&(t=s.children(".am-panel"))}),t.each((n,a,s=o(a))=>{n>=e.max_discuss&&s.hide()}))});g.reg("user-css","自定义样式表",".*",{css:{ty:"string"}},({msto:e})=>GM_addStyle(e.css));g.reg_chore("atdiff-fetch","获取 AtCoder 难度","10D","@/problem/AT.*",{atdiff:{ty:"string",priv:!0}},({msto:e})=>{let t={};P({url:"https://kenkoooo.com/atcoder/resources/problem-models.json",onload:n=>{let a=JSON.parse(n.responseText);for(let s in a)t[s]=a[s].difficulty;e.atdiff=JSON.stringify(t)}})});g.reg_pre("original-difficulty","显示原始难度",["@/problem/CF.*","@/problem/AT.*"],{cf_src:{ty:"enum",dft:"codeforces.com",vals:["codeforces.com","codeforces.ml"],info:["Codeforces problem source","CF 题目源"]}},async({msto:e})=>new Promise((t,n)=>{let a=location.pathname.match(/(CF|AT)([0-9]|[A-Z])*$/g)[0].substring(2);if(location.pathname.includes("CF")){let s=a.match(/^[0-9]*/g)[0],r=a.substring(s.length);P({url:`https://${e.cf_src}/problemset/problem/${s}/${r}`,onload:l=>{let c=o(l.responseText).find("span[title=Difficulty]").text().trim();t(c?c.substring(1):void 0)},onerror:l=>{z(l),n(l)}})}else{let s=JSON.parse(C["^atdiff-fetch"].atdiff),r=b.problem.description.match(RegExp("^.{22}[-./A-Za-z0-9_]*"))[0].match(RegExp("[^/]*$"));r in s?t(Math.round(s[r]>=400?s[r]:400/Math.exp(1-s[r]/400))):t(void 0)}}),({pred:e})=>{let t=document.querySelectorAll("div.field"),n=t[3].cloneNode(!0);t[3].after(n);let a=n.querySelectorAll("span");a[0].innerText="原始难度",a[1].innerText="获取中",e.then(s=>{s===void 0&&(s="不可用"),a[1].innerText=s})});var xe=".exlg-rand-settings{display:inline-block;padding:1px 5px;background-color:#fff;border:1px solid #6495ED;color:#6495ed;border-radius:6px;font-size:12px;position:relative;top:-2px}.exlg-rand-settings.selected{background-color:#6495ed;border:1px solid #6495ED;color:#fff}.exlg-rand-settings:hover{box-shadow:0 0 7px #1e90ff}.exlg-smallbtn{position:relative;display:inline-block;padding:1px 5px;color:#fff;border-radius:6px;font-size:12px;margin-left:1px;margin-right:1px}.exrand-enabled{width:49%;float:left}.exrand-disabled{width:49%;float:right}";g.reg("rand-problem-ex","随机跳题_ex","@/",{exrand_difficulty:{ty:"tuple",lvs:[{ty:"boolean",dft:!1,strict:!0,repeat:8}],priv:!0},exrand_source:{ty:"tuple",lvs:[{ty:"boolean",dft:!1,strict:!0,repeat:5}],priv:!0}},({msto:e})=>{let t=[["入门","red"],["普及-","orange"],["普及/提高-","yellow"],["普及+/提高","green"],["提高+/省选-","blue"],["省选/NOI-","purple"],["NOI/NOI+/CTSC","black"],["暂无评定","gray"]].map((m,w,y)=>({text:m[0],color:m[1],id:(w+1)%y.length})),n=[{text:"洛谷题库",color:"red",id:"P"},{text:"Codeforces",color:"orange",id:"CF"},{text:"SPOJ",color:"yellow",id:"SP"},{text:"AtCoder",color:"green",id:"AT"},{text:"UVA",color:"blue",id:"UVA"}],a=m=>{Y(m)&&(m=m.toUpperCase()),m===""||typeof m>"u"?x.show_alert("提示","请输入题号"):location.href="https://www.luogu.com.cn/problemnew/show/"+m},s=!1,r=!1,l=o("input[name='toproblem']");l.after(l.clone()).remove(),l=o("input[name='toproblem']");let c=o(".am-btn[name='goto']");c.after(c.clone()).remove(),c=o(".am-btn[name='goto']");let i=c.parent();o(".am-btn[name='gotorandom']").text("随机");let d=o('<button class="am-btn am-btn-success am-btn-sm" name="gotorandomex">随机ex</button>').appendTo(i);c.on("click",()=>{/^[0-9]+.?[0-9]*$/.test(l.val())&&l.val("P"+l.val()),a(l.val())}),l.on("keydown",m=>{m.keyCode===13&&c.click()});let p=o(`<span id="exlg-exrand-window" class="exlg-window" style="display: block;">
    <br>
    <ul></ul>
    </span>`).appendTo(i).hide().on("mouseenter",()=>{s=!0}).on("mouseleave",()=>{s=!1,r||p.hide()});o(".lg-index-stat>h2").text("问题跳转 ").append(o('<div id="exlg-dash-0" class="exlg-rand-settings">ex设置</div>'));let h=p.children("ul").css("list-style-type","none"),_=o('<div id="exlg-exrand-menu"></div>').appendTo(h);o("<br>").appendTo(h);let M=o('<div id="exlg-exrand-diff" class="smallbtn-list"></div>').appendTo(h),E=o('<div id="exlg-exrand-srce" class="smallbtn-list"></div>').appendTo(h).hide(),u=o.double(m=>o(`<div class="exlg-rand-settings exlg-unselectable exrand-entry">${m}</div>`).appendTo(_),"题目难度","题目来源");u[0].after(o('<span class="exlg-unselectable">&nbsp;&nbsp;</span>')),u[0].addClass("selected").css("margin-right","38px"),o.double(([m,w])=>{m.on("click",()=>{o(".exrand-entry").removeClass("selected"),m.addClass("selected"),o(".smallbtn-list").hide(),w.show()})},[u[0],M],[u[1],E]),o.double(([m,w,y])=>{let v=o.double(([T,O])=>o(`<span class="${T}">
        <span class="lg-small lg-inline-up exlg-unselectable">${O}</span>
        <br>
        </span>`).appendTo(m),["exrand-enabled","已选择"],["exrand-disabled","未选择"]);w.forEach((T,O)=>{let S=o.double(N=>o(`<div class="exlg-smallbtn exlg-unselectable">${T.text}</div>`).css("background-color",`var(--lg-${T.color}-problem)`).appendTo(N),v[0],v[1]);o.double(N=>{S[N].on("click",()=>{S[N].hide(),S[1-N].show(),y[O]=!!N}),y[O]===!!N&&S[N].hide()},0,1)})},[M,t,e.exrand_difficulty],[E,n,e.exrand_source]),o("#exlg-dash-0").on("mouseenter",()=>{r=!0,o.double(([m,w])=>{o.double(([y,v])=>{m.children(y).children(".exlg-smallbtn").each((T,O,S=o(O))=>w[T]===v?S.show():S.hide())},[".exrand-enabled",!0],[".exrand-disabled",!1])},[M,e.exrand_difficulty],[E,e.exrand_source]),p.show()}).on("mouseleave",()=>{r=!1,s||setTimeout(()=>{s||p.hide()},200)});let f=async()=>{let m=o.double(([ze,Ne,Pe])=>{let W=[];return ze.forEach((je,De)=>{Ne[De]&&W.push(je.id)}),W.length||(W=Pe),W[Math.floor(Math.random()*W.length)]},[t,e.exrand_difficulty,[0,1,2,3,4,5,6,7]],[n,e.exrand_source,["P"]]),w=await j(`/problem/list?difficulty=${m[0]}&type=${m[1]}&page=1`),y=w.currentData.problems.count,v=Math.ceil(y/50),T=Math.floor(Math.random()*v)+1;w=await j(`/problem/list?difficulty=${m[0]}&type=${m[1]}&page=${T}`);let O=w.currentData.problems.result,S=Math.floor(Math.random()*O.length),N=O[S].pid;location.href=`/problem/${N}`};d.on("click",f)},xe);var we=".exlg-rand-training-problem-btn{border-color:#343434;background-color:#343434}";g.reg_hook_new("rand-training-problem","题单内随机跳题","@/training/[0-9]+(#.*)?",{mode:{ty:"enum",vals:["unac only","unac and new","new only"],dft:"unac and new",info:["Preferences about problem choosing","随机跳题的题目种类"]}},({msto:e,args:t})=>{let n=e.mode.startsWith("unac")+e.mode.endsWith("only")*-1+2;!t.length||o(t[0].firstChild).clone(!0).appendTo(t).text("随机跳题").addClass("exlg-rand-training-problem-btn").on("click",()=>{let a=b.training,s=[];if(a.problems.some(l=>{a.userScore.score[l.problem.pid]===null?n&1&&s.push(l.problem.pid):a.userScore.score[l.problem.pid]<l.problem.fullScore&&n&2&&s.push(l.problem.pid)}),a.problemCount){if(!s.length)return n===1?$("您已经做完所有新题啦！"):n===2?$("您已经订完所有错题啦！"):$("您已经切完所有题啦！")}else return $("题单不能为空");let r=~~(Math.random()*1e6)%s.length;location.href="https://www.luogu.com.cn/problem/"+s[r]})},e=>{let t=o(e.target).find("div.operation");return{result:t.length>0,args:t}},()=>o("div.operation"),we);var ye=".exlg-badge{border-radius:50px;padding:4px 10px;transition:all .15s;display:inline-block;min-width:10px;font-size:1em;font-weight:700;background-color:#48d1cc;color:#fff;line-height:1;vertical-align:baseline;white-space:nowrap;cursor:pointer;margin-left:2px;margin-right:2px}";g.reg_chore("sponsor-list","获取标签列表","1D","@/.*",{tag_list:{ty:"string",priv:!0}},({msto:e})=>{P({url:"https://service-cmrlfv7t-1305163805.sh.apigw.tencentcs.com/release/get/0/0/",onload:t=>{e.tag_list=decodeURIComponent(t.responseText)}})});g.reg_hook_new("sponsor-tag","标签显示",["@/","@/paste","@/discuss/.*","@/problem/.*","@/ranking.*"],{use_new:{ty:"boolean",dft:!1,info:["Enable new","启用新版后端（实验性）"]},cache:{ty:"string",dft:"3600",info:["Cache time","缓存时间（秒）（仅限新版）"]},tag_list:{ty:"string",priv:!0},tag_cache:{ty:"string",priv:!0}},async({msto:e,args:t})=>{let n={};if(e.use_new){typeof e.tag_cache>"u"&&(e.tag_cache="{}");let s=JSON.parse(e.tag_cache),r=[],l=d=>{if(!d||d.hasClass("exlg-badge-required-username")||!/\/user\/[1-9][0-9]{0,}/.test(d.attr("href")))return;d.addClass("exlg-badge-required-username");let p=d.attr("href").slice(6);!(p in s)||Date.now()/1e3-s[p].ts>Number(e.cache)?r.push(p):"text"in s[p]&&(n[p]=s[p].text)};t.each((d,p)=>l(o(p)));let c=(await R({url:"https://exlg.piterator.com/badge/mget/",data:JSON.stringify(r),type:"application/json"})).responseText,i=JSON.parse(decodeURIComponent(c));for(let[d,p]of Object.entries(i))"text"in p?(n[d]=p.text,s[d]={},s[d].text=p.text,s[d].ts=Date.now()/1e3):(s[d]={},s[d].ts=Date.now()/1e3);e.tag_cache=JSON.stringify(s)}else n=JSON.parse(C["^sponsor-list"].tag_list);let a=s=>{if(!s||s.hasClass("exlg-badge-username")||!/\/user\/[1-9][0-9]{0,}/.test(s.attr("href")))return;s.addClass("exlg-badge-username");let r=s.attr("href").slice(6),l=n[r];if(!l)return;let c=o(r==="100250"?`<span class="am-badge am-radius lg-bg-red" style="margin-left: 4px;">${l}</span>`:`<span class="exlg-badge">${l}</span>`).off("contextmenu").on("contextmenu",()=>!1).on("mousedown",d=>{d.button===2?location.href="https://www.luogu.com.cn/paste/asz40850":d.button===0&&H()}),i=s;i.next().length&&i.next().hasClass("sb_amazeui")&&(i=i.next()),i.next().length&&i.next().hasClass("am-badge")&&(i=i.next()),i.after(c)};t.each((s,r)=>a(o(r)))},e=>{let t=o(e.target).find("a[target='_blank'][href]");return{result:t.length,args:t}},()=>o("a[target='_blank'][href]"),ye);var _e="iframe{border:none;display:block;width:100%;height:100%}iframe::-webkit-scrollbar{display:none}";g.reg_main("springboard","跨域跳板",["@bili/robots.txt?.*","@/robots.txt?.*"],null,()=>{let e=new URLSearchParams(location.search);switch(e.get("type")){case"update":x.addEventListener("message",n=>{n.data.unshift("update"),x.parent.postMessage(n.data,"*")});break;case"page":let t=e.get("url");(!e.get("confirm")||confirm(`是否加载来自 ${t} 的页面？`))&&(document.body.innerHTML=`<iframe src="${t}" exlg="exlg"></iframe>`);break;case"dash":break}},_e);var ve=".exlg-rand-tasklist-problem-btn{margin-left:.5em}";g.reg("tasklist-ex","任务计划 ex","@/",{auto_clear:{ty:"boolean",dft:!0,info:["Hide accepted problems","隐藏已经 AC 的题目"]},rand_problem_in_tasklist:{ty:"boolean",dft:!0,info:["Random problem in tasklist","任务计划随机跳题"]}},({msto:e})=>{let t=[];o.each(o("div.tasklist-item"),(r,l,c=o(l))=>{let i=c.attr("data-pid");l.innerHTML.search(/check/g)===-1&&e.rand_problem_in_tasklist&&t.push(i),c.find("i").hasClass("am-icon-check")&&c.addClass("tasklist-ac-problem")});let n=o('<div>[<a id="toggle-button">隐藏已AC</a>]</div>');o("button[name=task-edit]").parent().after(n);let a=o(".tasklist-ac-problem"),s=o("#toggle-button").on("click",()=>{a.toggle(),s.text(["隐藏","显示"][+(e.auto_clear=!e.auto_clear)]+"已 AC")});if(e.auto_clear&&s.click(),e.rand_problem_in_tasklist){let r=o('<button name="task-rand" class="am-btn am-btn-sm am-btn-success lg-right">随机</button>');o("button[name='task-edit']").before(r),r.addClass("exlg-rand-tasklist-problem-btn").click(()=>{let l=~~(Math.random()*1e6)%t.length;location.href+=`problem/${t[l]}`})}},ve);g.reg_chore("token","EXLG 令牌","1D","@/.*",{token:{ty:"string",priv:!0}},async({msto:e})=>{if(unsafeWindow._feInjection.currentUser){let t=JSON.parse((await R({url:"https://www.luogu.com.cn/paste/new?_contentOnly",data:JSON.stringify({data:JSON.parse((await K("https://exlg.piterator.com/token/generate/")).responseText),public:!0}),type:"application/json",header:{"x-csrf-token":o("[name='csrf-token']").attr("content"),referer:"https://www.luogu.com.cn/paste"}})).responseText).id;e.token=JSON.parse((await R({url:"https://exlg.piterator.com/token/verify/",data:JSON.stringify(t),type:"application/json"})).responseText).token,await R({url:`https://www.luogu.com.cn/paste/delete/${t}?_contentOnly`,header:{"x-csrf-token":o("[name='csrf-token']").attr("content"),referer:"https://www.luogu.com.cn/paste"}})}else return!0});var ke=`*< Improve version_cmp to fit -pre versions

-M token
 : 接收，验证和存储 exlg token
   ^? Header

-M message
 : 实时私信提醒

-- 新增新后端的注册器
*M sponsor-tag
 : 为新后端增加缓存，默认缓存时间为1h
 : 为新的badge后端增加支持

^M submission-color
 : 修复题目难度颜色加载完成后被覆盖的问题
^M dash-bridge
 : 修复了关注和粉丝链接反了的问题
^M benben-ranklist
 : 修复了用户名和条数不在一行的问题

-< \`async cs_post({ url, data, type, header })\`
*< Replace \` \` in \`info\` with \`_\` automatically
*< Allow chores to fail with a non-zero return value
^< Fix autofill update-log

*# Update eslint standards that make sense
*# Ignore .DS_Store and temporary files during build`;var $e=".exlg-update-log-text{overflow-x:auto;white-space:nowrap;text-align:left}";g.reg_chore("update","检查更新","1D",".*",null,()=>{X((e,t)=>t==="<<"&&$(`<p>检测到新版本 ${e}，点击确定将安装。</p>`,"检测到新版本",()=>location.href=`https://hub.fastgit.xyz/extend-luogu/extend-luogu/raw/${e}/dist/extend-luogu.min.user.js`))});var nt=["$","#<@"].map(e=>e.split("")),Ce={Ty:{"-":"添加",x:"删减","!":"重大","*":"修改","^":"修复",$:"重构"},Op:{"-":"特性","?":"文档","#":"依赖","<":"代码风格",">":"命令",M:"模块",H:"钩子","@":"GitHub Action"}};g.reg("update-log","更新日志显示","@/.*",{last_version:{ty:"string",priv:!0},style:{ty:"enum",vals:["Commit Message","自然语言"],get:"id",info:["The way to display log","显示 Log 的方式"]},keep_dev:{ty:"boolean",dft:!0,info:["Keep developer messages","保留开发者更新信息"]}},({msto:e})=>{if(location.href.includes("blog"))return;let t=GM_info.script.version,n=!1,a=s=>{let r=`<div class="exlg-update-log-text" style="font-family: ${C["code-block-ex"].copy_code_font};">`;return s.split(`
`).forEach(l=>{let c=l.trimStart();if(c.length){if(e.keep_dev)n=!1;else if(c[0]===":"){if(!n)return}else if(nt.some((i,d)=>i.includes(c[d]))){n=!1;return}else n=!0;e.style===1&&c[0]!==":"&&(l=" ".repeat(l.length-c.length)+Ce.Ty[c[0]]+Ce.Op[c[1]]+c.substring(2))}r+=`<div>${l.replace(/ /g,"&nbsp;")}</div>`}),r+"</div>"};switch(B(e.last_version,t)){case"==":break;case"<<":$(a(ke),`extend-luogu ver. ${t} 更新日志`);case">>":e.last_version=t}},$e);var Te=".exlg-usercom-edit{transition:all .4s;opacity:0}.exlg-usercom-edit:hover{transition:all .4s;opacity:.8}.exlg-usercom-tag{color:#8a7b7b;font-weight:lighter;font-size:.9em;margin-left:.3em;line-height:1em;font-family:Consolas}";var A=null;g.reg_hook_new("user-comment","用户备注",".*",{comments:{ty:"string",dft:"{}",priv:!0},direct_display:{ty:"boolean",dft:!0,info:["Directly replace username","直接替换用户名"]}},({msto:e,result:t,args:n})=>{let a=(s,r)=>{if(!(!r||!s)&&!!s.length){if(s.length!==1){s.each((l,c)=>a(o(c),r));return}s.children("span[style]").length&&(s=s.children("span[style]")),s.css("white-space","pre"),e.direct_display?s.text(r):s.append(`<span class="exlg-usercmt exlg-usercom-tag">(${r})</span>`)}};if(!t){A=JSON.parse(e.comments);for(let[s,r]of Object.entries(A))(r===null||r==="")&&delete A[s];if(/^\/user\/[1-9][0-9]{0,}$/.test(location.pathname)){let s=o(".user-info > div.user-name"),r=s.text(),l=parseInt(location.pathname.slice(6));s.html("");let c=o('<span id="exlg-name-text"></span>').appendTo(s);c.text(l in A?A[l]:r);let i=o('<span title="修改用户备注"><svg class="icon exlg-usercom-edit" style="width: 1.2em;height: 1.2em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="942"><path d="M295.384615 708.923077h433.23077a19.692308 19.692308 0 1 1 0 39.384615h-433.23077a19.692308 19.692308 0 1 1 0-39.384615zM590.769231 303.576615L618.653538 275.692308l72.979693 73.019077-27.844923 27.844923L590.769231 303.576615z m-236.307693 196.923077L382.345846 472.615385l89.284923 89.324307-27.844923 27.844923L354.461538 500.499692zM401.329231 616.841846l308.342154-308.342154-55.689847-55.689846-308.381538 308.342154-8.152615 63.881846 63.881846-8.192z m-93.065846-74.043077l317.833846-317.833846a39.384615 39.384615 0 0 1 55.729231 0l55.689846 55.689846a39.384615 39.384615 0 0 1 0 55.689846l-317.833846 317.833847-127.763693 16.344615 16.344616-127.724308z" p-id="943"></path></svg></span>');s.append(i),i.on("click",()=>{$(`<div>请设置用户 <span style="font-family: Consolas, monospace;">${r} (uid: ${l})</span> 的备注名<br>留空则清除备注。</div><input exlg-badge-register type="text" style="font-family: Consolas, monospace;line-height: 1.5;padding: .1em;" class="am-form-field exlg-badge-input" placeholder="填写用户名或uid" name="username" id="exlg-user-com-input">`,"exlg 用户备注",()=>{let d=o("#exlg-user-com-input").val();d.trim()===""?(delete A[l],d=r):A[l]=d,a(o(`a[href="/user/${l}"][target=_blank]`)),e.comments=JSON.stringify(A),c.text(l in A?A[l]:r)},!0),o("#exlg-user-com-input").val(l in A?A[l]:r)})}}n.forEach(s=>{let r=o(s),l=s.href.split("/").lastElem();r.hasClass("exlg-usercmt")||(r.addClass("exlg-usercmt"),l in A&&a(r,A[l]))})},e=>{let t=e.target.querySelectorAll('a[href^="/user"][target=_blank]');return{result:t.length>0,args:t}},()=>document.querySelectorAll('a[href^="/user"][target=_blank]'),Te);var Me="iframe{border:none;display:block}iframe::-webkit-scrollbar{display:none}";g.reg_user_tab("user-intro-ins","用户首页_HTML_显示","main",null,null,()=>{o(".introduction > *").each((e,t,n=o(t))=>{let a=n.text(),[,,s,r]=a.match(/^(exlg.|%)([a-z]+):([^]+)$/)??[];if(!s)return;r=r.split(/(?<!!)%/g).map(c=>c.replace(/!%/g,"%"));let l=o(o(".user-action").children()[0]);switch(s){case"html":n.replaceWith(o(`<p exlg="exlg">${F.process(r[0])}</p>`));break;case"frame":n.replaceWith(Z({type:"page",url:encodeURI(r[0]),confirm:!0},`width: ${r[1]}; height: ${r[2]};`));break;case"blog":if(l.text().trim()!=="个人博客")return;l.attr("href",r),n.remove();break}})},Me);var G={NOT_AT_PRACTICE_PAGE:-1,NONE:-2,COMMENT_TAG:-3,NOT_A_PROBLEM_ELEMENT:-4,ADD_COMPARE:1};var Le=".main>.card>h3{display:inline-block}";var se={SUBMITTED_PROBLEMS:0,PASSED_PROBLEMS:1},Ee=-1,Se=se.SUBMITTED_PROBLEMS,te=-1,V=null,oe=null;g.reg_hook_new("user-problem-color","题目颜色数量和比较","@/user/[0-9]{0,}.*",{problem_compare:{ty:"boolean",strict:!0,dft:!0,info:["AC compare","AC题目比较"]}},({msto:e,args:t})=>{let n=[[191,191,191],[254,76,97],[243,156,17],[255,193,22],[82,196,26],[52,152,219],[157,61,207],[14,29,105]],a=async(r,l)=>{if(V===null){let i=await j(`/user/${L.uid}`);V=b.passedProblems,oe=new Set,i.currentData.passedProblems.forEach((d,p)=>oe.add(d.pid))}let c=0;l&&r[1].querySelectorAll("a").forEach((d,p)=>{p<V.length&&oe.has(V[p].pid)&&(c++,d.style.backgroundColor="rgba(82, 196, 26, 0.3)")}),o("#exlg-problem-count-1").html(`<span class="exlg-counter" exlg="exlg">${V.length} <> ${oe.size} : ${c}<i class="exlg-icon exlg-info" name="ta 的 &lt;&gt; 我的 : 相同"></i></span>`)},s=r=>`rgb(${n[r][0]}, ${n[r][1]}, ${n[r][2]})`;if(typeof t=="object"&&t.message===G.ADD_COMPARE){if(!e.problem_compare||b.user.uid===L.uid)return;a([114514,1919810],!1);return}t.forEach(r=>{if(r.target.href!=="javascript:void 0"&&(r.target.style.color=s([(r.board_id?b.passedProblems:b.submittedProblems)[r.position].difficulty]),r.board_id===se.PASSED_PROBLEMS&&r.position===b.passedProblems.length-1||b.passedProblems.length===0&&r.board_id===se.SUBMITTED_PROBLEMS&&r.position===b.submittedProblems.length-1)){o(".exlg-counter").remove();let l=r.target.parentNode.parentNode.parentNode.parentNode,c=[l.firstChild.childNodes[2],l.lastChild.childNodes[2]];for(let i=0;i<2;++i){let d=c[i],p=b[["submittedProblems","passedProblems"][i]];d.before(o(`<span id="exlg-problem-count-${i}" class="exlg-counter" exlg="exlg">${p.length}</span>`)[0])}if(!e.problem_compare||b.user.uid===L.uid)return;a(c,!0)}})},e=>{if(location.hash!=="#practice")return{result:!1,args:{message:G.NOT_AT_PRACTICE_PAGE}};if(!b.submittedProblems.length&&!b.passedProblems.length){if(e.target.className==="card padding-default")if(o(e.target).children(".problems").length){let r=b[["submittedProblems","passedProblems"][te]];if(o(e.target.firstChild).after(`<span id="exlg-problem-count-${te}" class="exlg-counter" exlg="exlg" style="margin-left: 5px">${r.length}</span>`),++te>1)return{result:!0,args:{message:G.ADD_COMPARE}}}else o(e.target).children(".difficulty-tags").length&&(te=0);return{result:!1,args:{message:G.NONE}}}if(!e.target.tagName)return{result:!1,args:{message:G.COMMENT_TAG}};if(e.target.tagName.toLowerCase()!=="a"||e.target.className!=="color-default"||e.target.href.indexOf("/problem/")===-1)return{result:!1,args:{message:G.NOT_A_PROBLEM_ELEMENT}};let t=r=>r?r.pid:void 0,n=e.target,a=[t(b.submittedProblems[0]),t(b.passedProblems[0])].indexOf(n.href.slice(33)),s=a!==-1;return{result:!0,args:[{onchange:s,board_id:s?Se=a:Se,position:s?Ee=0:++Ee,target:n}]}},()=>{if(!b.submittedProblems.length&&!b.passedProblems.length){o(".exlg-counter").remove();let e=o(".card.padding-default > .problems");for(let t=0;t<2;++t){let n=o(e[t]),a=b[["submittedProblems","passedProblems"][t]];n.before(`<span id="exlg-problem-count-${t}" class="exlg-counter" exlg="exlg">${a.length}</span>`)}return{message:G.ADD_COMPARE}}return[]},Le);var Ae="#exlg-vp{margin-right:.5em;display:inline-block;flex:none;outline:0;cursor:pointer;color:#fff;font-weight:inherit;line-height:1.5;text-align:center;vertical-align:middle;background:0 0;border-radius:3px;border:1px solid;border-color:#52c41a;background-color:#52c41a}";g.reg("virtual-participation","创建重现赛","@/contest/[0-9]*(#.*)?",{},()=>{if(b.contest.name.match("Virtual Participation")){let e=o(".items"),t=()=>{(location.hash||"#main")==="#problems"&&o(".pid").length!==0&&b.contest.startTime>re(1e3)&&(o("a.title.color-default").on("click",()=>{$("比赛尚未开始, 请开始后再查看题目")}),o("a.title.color-default").removeAttr("href"))};e.on("click",t),t();return}if(b.contest.endTime>re(1e3)){q("Contest has not started or ended.");return}o("<button id='exlg-vp' class='lfe-form-sz-middle'>重现比赛</button>").appendTo(o("div.operation")).click(async()=>{$(`<div>
                <p>设置「${b.contest.name}」的重现赛</p>
                <p>开始时间：<input type="date" id="vpTmDt"/> <input type="time" id="vpTmClk"/></p>
            </div><br>`,"创建重现赛",async()=>{let e=o("#vpTmDt")[0].value.split("-"),t=o("#vpTmClk")[0].value.split(":"),n=new Date(e[0],e[1]-1,e[2],t[0],t[1],0,0);n=n.getTime()/1e3;let a="",s="";o.each(b.contestProblems,(d,p)=>{d&&(a+=",",s+=","),a+='"'+p.problem.pid+'"',s+=`"${p.problem.pid}": ${p.problem.fullScore}`});let r=null,l=`{
                    "settings":{
                        "name": "Virtual Participation for ${b.contest.name}",
                        "description": ${JSON.stringify(b.contest.description)},
                        "visibilityType":5,
                        "invitationCodeType":1,
                        "ruleType":${b.contest.ruleType},
                        "startTime":${n},
                        "endTime":${n+b.contest.endTime-b.contest.startTime},
                        "rated":false,
                        "ratingGroup":null
                    },
                    "hostID":${L.uid}
                }`;r=await I("/fe/api/contest/new",l);let c=r.id.toString();switch(r.status??200){case 200:c=r.id.toString();break;default:z(`Failed to modify contest ${c} with status code ${r.status}.`)}r=null;try{r=await I(`/fe/api/contest/editProblem/${c}`,`{
                            "pids":[${a}],
                            "scores":{${s}}
                        }`)}catch{$("<p>本场比赛的题目不公开</p>","重现赛创建失败");return}let i=await j(`/contest/edit/${c}`);await I(`/fe/api/contest/join/${c}`,`{"code": "${i.currentData.contest.joinCode}"}`),$(`<p>邀请码: ${i.currentData.contest.joinCode}</p>
                    <p>点确定自动跳转</p>`,"重现赛创建成功",()=>{location.href=`https://www.luogu.com.cn/contest/${c}`})},!1)})},Ae);k("Exposing");Object.assign(x,{exlg:{mod:g,log:k,error:z,springboard:Z,version_cmp:B,lg_alert:Q,lg_content:j,register_badge:H,lg_post:I,TM_dat:{reload_dat:e=>(raw_dat=null,load_dat(e,{map:t=>{t.root=!t.rec,t.itmRoot=t.rec===2}})),type_dat,proxy_dat,load_dat,save_dat,clear_dat,raw_dat}},GM:{GM_info,GM_addStyle,GM_setClipboard,GM_xmlhttpRequest,GM_getValue,GM_setValue,GM_deleteValue,GM_listValues},$$:o,xss:F,marked});var Oe=e=>{try{x.exlg.TM_dat.sto=x.exlg.TM_dat.reload_dat({...g.data,...D.data}),g.fake_sto=D.sto=x.exlg.TM_dat.sto}catch(t){if(e)Q("存储代理加载失败，清存重试中……"),clear_dat(),Oe(e-1);else throw Q("失败次数过多，自闭中。这里建议联系开发人员呢。"),t}};Oe(1);x.exlg.TM_dat.sto["hide-solution"].on&=x.exlg.TM_dat.sto["hide-solution"].hidesolu;D.ready();g.preload();o(()=>{k("Launching"),g.execute()});})();
